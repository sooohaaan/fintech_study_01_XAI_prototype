<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TrustFin - í™ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="common.js"></script>
    <style>
        @keyframes slideDownHeader {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-header-down {
            animation: slideDownHeader 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        /* Scrollbar Hide */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%) skewX(-15deg); }
            100% { transform: translateX(200%) skewX(-15deg); }
        }
        .group:hover .animate-shimmer, .group:active .animate-shimmer {
            animation: shimmer 1.5s infinite;
        }
    </style>
</head>
<body class="text-gray-800 dark:text-gray-100 font-sans select-none transition-colors duration-300 bg-black">
    <!-- Top Toast Message -->
    <div id="topToast" class="fixed top-6 left-1/2 transform -translate-x-1/2 -translate-y-24 bg-gray-800 dark:bg-white text-white dark:text-gray-900 px-6 py-3 rounded-full shadow-xl flex items-center gap-3 transition-all duration-500 z-50 opacity-0 pointer-events-none">
        <i data-lucide="check-circle" class="w-5 h-5 text-green-400 dark:text-green-600"></i>
        <span id="toastText" class="text-sm font-bold">ì•Œë¦¼ ë‚´ìš©</span>
    </div>

    <!-- Spending Tooltip -->
    <div id="spendingTooltip" onclick="this.classList.add('opacity-0', 'pointer-events-none')" class="fixed z-50 bg-red-500 text-white text-xs font-bold px-3 py-1.5 rounded-lg shadow-lg opacity-0 transition-opacity duration-200 pointer-events-none transform -translate-x-1/2 -translate-y-full cursor-pointer">
        ì˜ˆì‚° ì´ˆê³¼ ìœ„í—˜
        <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1 w-2 h-2 bg-red-500 rotate-45"></div>
    </div>

    <!-- Progress Modal -->
    <div id="progressModal" class="fixed inset-0 z-50 hidden flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-md transition-opacity" onclick="closeProgressModal()"></div>
        <div class="bg-white dark:bg-gray-800 rounded-t-card p-6 w-full max-w-md shadow-2xl relative z-10 animate-slide-up">
            <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-6"></div>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-blue-50 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4 text-deepBlue dark:text-blue-400">
                    <i data-lucide="loader-2" class="w-8 h-8 animate-spin"></i>
                </div>
                <h3 id="progressProductName" class="text-lg font-bold text-gray-900 dark:text-white mb-1">ìƒí’ˆëª…</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">ì‹¬ì‚¬ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="text-gray-500 dark:text-gray-400">ì§„í–‰ë¥ </span>
                        <span id="progressPercent" class="font-bold text-deepBlue dark:text-blue-400">0%</span>
                    </div>
                    <div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2 overflow-hidden">
                        <div id="progressBar" class="bg-deepBlue dark:bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-card p-4 text-xs text-gray-500 dark:text-gray-400 space-y-3">
                    <div id="step1" class="flex items-center gap-3 transition-all duration-300 opacity-50">
                        <div class="icon-box"><i data-lucide="circle" class="w-4 h-4"></i></div>
                        <span>ì‹ ìš©ì ìˆ˜ ì¡°íšŒ</span>
                    </div>
                    <div id="step2" class="flex items-center gap-3 transition-all duration-300 opacity-50">
                        <div class="icon-box"><i data-lucide="circle" class="w-4 h-4"></i></div>
                        <span>ì†Œë“ ì •ë³´ í™•ì¸</span>
                    </div>
                    <div id="step3" class="flex items-center gap-3 transition-all duration-300 opacity-50">
                        <div class="icon-box"><i data-lucide="circle" class="w-4 h-4"></i></div>
                        <span>ìµœì¢… í•œë„ ì‚°ì¶œ</span>
                    </div>
                </div>
            </div>

            <button onclick="closeProgressModal()" class="w-full mt-6 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold py-3 rounded-card hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                ë‹«ê¸°
            </button>
        </div>
    </div>

    <!-- Credit Score Detail Modal -->
    <div id="creditScoreModal" class="fixed inset-0 z-50 hidden flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-md transition-opacity" onclick="closeCreditScoreModal()"></div>
        <div class="bg-white dark:bg-gray-800 rounded-t-card p-5 w-full max-w-md shadow-2xl relative z-10 animate-slide-up h-[85vh] flex flex-col">
            <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-6 flex-shrink-0"></div>
            
            <!-- Tabs -->
            <div class="flex p-1 bg-gray-100 dark:bg-gray-700 rounded-card mb-6 flex-shrink-0">
                <button onclick="switchCreditScoreTab('kcb')" id="tab-kcb" class="flex-1 py-2 text-xs font-bold rounded-card bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm transition-all">KCB</button>
                <button onclick="switchCreditScoreTab('nice')" id="tab-nice" class="flex-1 py-2 text-xs font-bold rounded-card text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-all">NICE</button>
            </div>

            <div class="flex-1 overflow-y-auto pr-1">
                <div class="text-center mb-8">
                    <span id="modalScoreAgency" class="text-xs font-bold text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full">KCB ì˜¬í¬ë ˆë”§ ê¸°ì¤€</span>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mt-4 mb-2"><span id="modalCreditScore">0</span>ì </h2>
                    <p id="modalScoreChange" class="text-xs text-green-600 dark:text-green-400 font-bold flex items-center justify-center gap-1">
                        <i data-lucide="trending-up" class="w-4 h-4"></i>
                        ì§€ë‚œë‹¬ë³´ë‹¤ 15ì  ìƒìŠ¹
                    </p>
                </div>

                <!-- Score Gauge (Visual) -->
                <div class="relative h-4 bg-gray-100 dark:bg-gray-700 rounded-full mb-2 overflow-hidden">
                    <div id="modalScoreBar" class="absolute top-0 left-0 h-full bg-gradient-to-r from-green-400 to-blue-500 transition-all duration-1000" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-400 mb-8">
                    <span>0</span>
                    <span>1000</span>
                </div>

                <!-- Score Trend Chart -->
                <div class="mb-8">
                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">ì ìˆ˜ ë³€ë™ ì¶”ì´</h3>
                    <div class="bg-gray-50 dark:bg-gray-700/30 rounded-card p-4 border border-gray-100 dark:border-gray-700">
                        <div class="relative h-32 w-full">
                            <svg id="scoreTrendChart" class="w-full h-full overflow-visible"></svg>
                            <!-- Tooltip -->
                            <div id="scoreTooltip" class="absolute bg-gray-900/95 dark:bg-white/95 backdrop-blur-sm text-white dark:text-gray-900 text-xs font-medium px-4 py-2 rounded-xl shadow-xl border border-white/10 dark:border-gray-200 pointer-events-none opacity-0 transition-all duration-300 transform -translate-x-1/2 -translate-y-full scale-90 z-10 whitespace-nowrap" style="top: 0; left: 0;">
                                <span id="tooltipReason"></span>
                                <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1 w-2.5 h-2.5 bg-gray-900/95 dark:bg-white/95 rotate-45 border-r border-b border-white/10 dark:border-gray-200"></div>
                            </div>
                        </div>
                        <div id="scoreChartLabels" class="flex justify-between text-xs text-gray-400 mt-2 px-1"></div>
                    </div>
                </div>

                <!-- Analysis Cards -->
                <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">ìƒì„¸ í‰ê°€ í•­ëª©</h3>
                <div id="scoreAnalysisItems" class="space-y-3">
                    <!-- JS Rendering -->
                </div>
                
                <!-- Tip -->
                <div id="creditScoreTip" class="mt-6 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-card border border-blue-100 dark:border-blue-800 transition-all duration-500">
                    <h4 class="font-bold text-deepBlue dark:text-blue-400 text-sm mb-2">ğŸ’¡ ì‹ ìš©ì ìˆ˜ ì˜¬ë¦¬ê¸° íŒ</h4>
                    <p class="text-xs text-gray-600 dark:text-gray-300 leading-relaxed">
                        ì‹ ìš©ì¹´ë“œë¥¼ í•œë„ ëŒ€ë¹„ 30~50% ìˆ˜ì¤€ìœ¼ë¡œ ê¾¸ì¤€íˆ ì‚¬ìš©í•˜ê³ , í†µì‹ ë¹„ë‚˜ ê³µê³¼ê¸ˆì„ ì„±ì‹¤í•˜ê²Œ ë‚©ë¶€í•˜ë©´ ì ìˆ˜ ìƒìŠ¹ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <button onclick="closeCreditScoreModal()" class="w-full mt-4 bg-black text-white font-bold py-3 rounded-card hover:bg-gray-700 transition flex-shrink-0">
                í™•ì¸
            </button>
        </div>
    </div>

    <!-- Score Criteria Modal -->
    <div id="scoreCriteriaModal" class="fixed inset-0 z-50 hidden flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-md transition-opacity" onclick="closeScoreCriteriaModal()"></div>
        <div class="bg-white dark:bg-gray-800 rounded-t-card p-6 w-full max-w-md shadow-2xl relative z-10 animate-slide-up">
            <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-6"></div>
            <h3 id="criteriaTitle" class="text-lg font-bold text-gray-900 dark:text-white mb-4">í‰ê°€ ê¸°ì¤€</h3>
            <p id="criteriaDesc" class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed mb-6">ë‚´ìš©</p>
            <button onclick="closeScoreCriteriaModal()" class="w-full bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white font-bold py-3 rounded-card hover:bg-gray-200 dark:hover:bg-gray-600 transition">í™•ì¸</button>
        </div>
    </div>

    <!-- Spending Detail Modal -->
    <div id="spendingModal" class="fixed inset-0 z-50 hidden flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-md transition-opacity" onclick="closeSpendingModal()"></div>
        <div class="bg-white dark:bg-gray-800 rounded-t-card p-6 w-full max-w-md shadow-2xl relative z-10 animate-slide-up">
            <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-6"></div>
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-2">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">ì´ë²ˆ ë‹¬ ì†Œë¹„ ìƒì„¸</h3>
                    <span id="spendingModalBadge" class="text-xs font-bold px-2 py-1 rounded hidden"></span>
                </div>
                <button onclick="closeSpendingModal()" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <!-- Item 1 -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-900 dark:text-white">
                            <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-900 dark:text-white">ì‡¼í•‘/ë§ˆíŠ¸</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">65%</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="spendingModalItem1Amount" class="font-bold text-gray-900 dark:text-white">812,500ì›</div>
                        <div id="spendingModalItem1Change" class="text-[10px]"></div>
                    </div>
                </div>
                <!-- Item 2 -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-900 dark:text-white">
                            <i data-lucide="utensils" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-900 dark:text-white">ì‹ë¹„</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">20%</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="spendingModalItem2Amount" class="font-bold text-gray-900 dark:text-white">250,000ì›</div>
                        <div id="spendingModalItem2Change" class="text-[10px]"></div>
                    </div>
                </div>
                <!-- Item 3 -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-900 dark:text-white">
                            <i data-lucide="bus" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-900 dark:text-white">êµí†µ</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">15%</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="spendingModalItem3Amount" class="font-bold text-gray-900 dark:text-white">187,500ì›</div>
                        <div id="spendingModalItem3Change" class="text-[10px]"></div>
                    </div>
                </div>
            </div>

            <div class="mt-6 pt-4 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center">
                <span class="text-sm text-gray-500 dark:text-gray-400">ì´ ì§€ì¶œ</span>
                <div class="text-right">
                    <div id="spendingModalTotalAmount" class="text-lg font-bold text-gray-900 dark:text-white">1,250,000ì›</div>
                    <div id="spendingModalTotalChange" class="text-xs mt-0.5"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="app-content" class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-all duration-300 ease-out origin-top pb-24">
    <!-- Header -->
    <header class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-md h-14 sticky top-0 z-20 shadow-sm dark:shadow-gray-900/50 transition-colors duration-300 animate-header-down">
        <div class="max-w-md mx-auto h-full flex items-center justify-between px-5">
            <!-- Mission Info Container -->
            <div id="headerMissionInfo" onclick="location.href='mission_list.html'" class="flex-1 flex items-center gap-3 cursor-pointer overflow-hidden mr-2">
                <!-- JS Injected -->
            </div>
            <a href="notification.html" class="flex-shrink-0 p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition -mr-2">
                <div class="relative">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span id="badge-notification" class="absolute -top-0.5 -right-0.5 bg-red-500 text-white text-[9px] font-bold px-1 py-0.5 rounded-full min-w-[1rem] flex items-center justify-center hidden border-2 border-white dark:border-gray-800"></span>
                </div>
            </a>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="p-4 max-w-md mx-auto space-y-2">
        
        <!-- Account List -->
        <div>
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-sm text-gray-900 dark:text-white">ë‚´ ê³„ì¢Œ</h3>
                <button onclick="location.href='my_accounts.html'" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition">
                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                </button>
            </div>
            <div id="accountList" class="space-y-3">
                <!-- JSë¡œ ê³„ì¢Œ ëª©ë¡ ë Œë”ë§ -->
            </div>
        </div>

        <!-- My Spending (New) -->
        <div>
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-sm text-gray-900 dark:text-white">ë‚´ ì†Œë¹„</h3>
                <button onclick="location.href='my_spending.html'" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition">
                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                </button>
            </div>
            <div id="spendingSection">
                <!-- JS Rendering -->
            </div>
        </div>

        <!-- Credit Score (New) -->
        <div>
            <div class="flex items-center gap-2 mb-2">
                <h3 class="font-bold text-sm text-gray-900 dark:text-white">ë‚´ ì‹ ìš©ì ìˆ˜</h3>
                <button id="creditScoreToggleBtn" onclick="toggleCreditScoreVisibility(event)" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition p-0.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i data-lucide="eye" class="w-4 h-4"></i>
                </button>
            </div>
            <div id="creditScoreSection" class="flex gap-3">
                <!-- KCB -->
                <div class="flex-1 bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 transition-colors cursor-pointer active:scale-95 transform transition-transform" onclick="openCreditScoreModal()">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-900 dark:text-white">
                                <i data-lucide="shield-check" class="w-3 h-3"></i>
                            </div>
                            <span class="text-xs font-bold text-gray-500 dark:text-gray-400">KCB</span>
                        </div>
                        <span id="kcbChangeBadge" class="text-xs font-bold text-gray-900 bg-gray-100 dark:bg-gray-700 dark:text-white px-2 py-1 rounded flex items-center gap-0.5">
                            <i data-lucide="trending-up" class="w-3 h-3"></i> 15
                        </span>
                    </div>
                    <div class="mb-3">
                        <h2 class="text-lg font-bold text-gray-900 dark:text-white"><span id="myCreditScoreKCB">0</span><span class="text-xs font-medium text-gray-400 ml-1">ì </span></h2>
                        <p class="text-[10px] text-gray-400 mt-1">ìƒìœ„ <span id="creditScorePercentKCB">0</span>%</p>
                    </div>
                    <div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden">
                        <div id="creditScoreBarKCB" class="bg-gradient-to-r from-blue-600 to-blue-400 h-1.5 rounded-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                </div>

                <!-- NICE -->
                <div class="flex-1 bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 transition-colors cursor-pointer active:scale-95 transform transition-transform" onclick="openCreditScoreModal()">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-900 dark:text-white">
                                <i data-lucide="shield-check" class="w-3 h-3"></i>
                            </div>
                            <span class="text-xs font-bold text-gray-500 dark:text-gray-400">NICE</span>
                        </div>
                        <span id="niceChangeBadge" class="text-xs font-bold text-gray-500 bg-gray-100 dark:bg-gray-700 dark:text-gray-400 px-2 py-1 rounded flex items-center gap-0.5">
                            <i data-lucide="trending-down" class="w-3 h-3"></i> 5
                        </span>
                    </div>
                    <div class="mb-3">
                        <h2 class="text-lg font-bold text-gray-900 dark:text-white"><span id="myCreditScoreNICE">0</span><span class="text-xs font-medium text-gray-400 ml-1">ì </span></h2>
                        <p class="text-[10px] text-gray-400 mt-1">ìƒìœ„ <span id="creditScorePercentNICE">0</span>%</p>
                    </div>
                    <div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden">
                        <div id="creditScoreBarNICE" class="bg-gradient-to-r from-gray-400 to-gray-300 h-1.5 rounded-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <!-- Credit Score Tip Banner -->
            <div id="creditScoreTipBanner" onclick="openCreditScoreModal(true)" class="mt-2 bg-gray-50 dark:bg-gray-800 rounded-card p-2.5 flex items-center justify-between cursor-pointer active:scale-95 transition-transform border border-gray-100 dark:border-gray-700 shadow-lg">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-white dark:bg-gray-700 flex items-center justify-center text-gray-900 dark:text-white shadow-sm">
                        <i data-lucide="lightbulb" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-gray-900 dark:text-white">ì‹ ìš©ì ìˆ˜ ì˜¬ë¦¬ê¸° ê¿€íŒ</p>
                        <p class="text-[10px] text-gray-500 dark:text-gray-400">ì ìˆ˜ ìƒìŠ¹ ë¹„ë²• í™•ì¸í•˜ê¸°</p>
                    </div>
                </div>
                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
            </div>
        </div>

        <!-- Loan Section (Modified) -->
        <div>
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-sm text-gray-900 dark:text-white">ë‚´ ëŒ€ì¶œ</h3>
                <button onclick="location.href='my_loans.html'" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition">
                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                </button>
            </div>
            <div id="loanSection">
                <!-- JSë¡œ ë‚´ìš© êµì²´ -->
            </div>
        </div>

    </main>
    </div>

    <!-- Transfer Modal -->
    <div id="transferModal" class="fixed inset-0 z-50 hidden flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-md transition-opacity" onclick="closeTransferModal()"></div>
        <div class="bg-white dark:bg-gray-800 rounded-t-card p-6 w-full max-w-md shadow-2xl relative z-10 animate-slide-up">
            <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-6"></div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1">ì†¡ê¸ˆí•˜ê¸°</h3>
            <p id="transferBankName" class="text-sm text-gray-500 mb-4">ì€í–‰ ê³„ì¢Œì—ì„œ ì†¡ê¸ˆ</p>
            
            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-500 mb-1">ë³´ë‚¼ ê¸ˆì•¡</label>
                <div class="flex items-center border border-gray-200 dark:border-gray-600 rounded-card px-4 bg-gray-50 dark:bg-gray-700/30 focus-within:border-deepBlue transition">
                    <input type="number" id="transferAmount" placeholder="ê¸ˆì•¡ ì…ë ¥" class="w-full text-lg font-bold py-3 outline-none bg-transparent dark:text-white">
                    <span class="text-gray-900 dark:text-white font-bold">ì›</span>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="closeTransferModal()" class="flex-1 py-3 rounded-card bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold hover:bg-gray-200 dark:hover:bg-gray-600 transition">ì·¨ì†Œ</button>
                <button onclick="submitTransfer()" class="flex-1 py-3 rounded-card bg-black text-white font-bold hover:bg-gray-700 transition transform active:scale-95">ë³´ë‚´ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ê³µí†µ UI ì´ˆê¸°í™” (í™ˆ íƒ­ í™œì„±í™”)
            initCommonUI('home');

            // ë¡œê·¸ì¸ëœ í¼ì†Œë‚˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const personaData = localStorage.getItem('trustFinPersona');
            if (!personaData) {
                // ë¡œê·¸ì¸ ì •ë³´ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                location.href = 'login.html';
                return;
            }
            
            const persona = JSON.parse(personaData);

            // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ë°°ì§€ ì¶”ê°€
            if (persona.id === 'guest') {
                const headerCenter = document.querySelector('header .absolute.left-1\\/2');
                if (headerCenter) {
                    const badge = document.createElement('span');
                    badge.className = 'ml-2 text-[10px] font-bold text-gray-500 bg-gray-100 dark:bg-gray-700 dark:text-gray-300 px-2 py-0.5 rounded-full border border-gray-200 dark:border-gray-600 whitespace-nowrap';
                    badge.innerText = 'ê²ŒìŠ¤íŠ¸ ëª¨ë“œì…ë‹ˆë‹¤';
                    headerCenter.appendChild(badge);
                }
            }

            renderAccounts();
            renderMissions(); // ë¯¸ì…˜ ë Œë”ë§ ì¶”ê°€
            window.refreshData = renderAccounts; // ê³µí†µ ì†¡ê¸ˆ ë¡œì§ì—ì„œ í˜¸ì¶œí•  ê°±ì‹  í•¨ìˆ˜ ì—°ê²°

            // ëª¨ë‹¬ ë“œë˜ê·¸ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initBottomSheetDrag('progressModal', closeProgressModal);
            initBottomSheetDrag('spendingModal', closeSpendingModal);
            initBottomSheetDrag('transferModal', closeTransferModal);
            initBottomSheetDrag('creditScoreModal', closeCreditScoreModal);
            initBottomSheetDrag('scoreCriteriaModal', closeScoreCriteriaModal);

            renderMyLoans();
            renderCreditScore();
            renderMySpending();
        });

        // (1) ì‹¤ì‹œê°„ ë°˜ì˜ì„ ìœ„í•œ pageshow ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ë’¤ë¡œê°€ê¸° ì‹œì—ë„ ë°ì´í„° ê°±ì‹ )
        window.addEventListener('pageshow', () => {
            renderMissions();
            renderAccounts();
            renderMyLoans();
            renderCreditScore();
            renderMySpending();
        });

        function renderMissions() {
            const headerMissionInfo = document.getElementById('headerMissionInfo');
            
            const personaData = localStorage.getItem('trustFinPersona');
            if (!personaData) return;
            
            const persona = JSON.parse(personaData);
            
            // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì²˜ë¦¬
            if (persona.id === 'guest') {
                if (headerMissionInfo) {
                    headerMissionInfo.innerHTML = `
                        <div class="flex items-center gap-2">
                            <i data-lucide="shield-check" class="w-5 h-5 text-deepBlue dark:text-blue-400"></i>
                            <span class="font-bold text-gray-900 dark:text-white">TrustFin</span>
                            <span class="text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded text-gray-500">Guest</span>
                        </div>
                    `;
                    if (window.lucide) window.lucide.createIcons();
                }
                return;
            }

            // 1. ì €ì¥ëœ ë¯¸ì…˜ ë¶ˆëŸ¬ì˜¤ê¸°
            let missions = JSON.parse(localStorage.getItem('trustFinMissions') || '[]');
            
            // ë°ì´í„° í¬ë§·íŒ… (í˜¸í™˜ì„±)
            missions = missions.map(m => ({
                ...m,
                subMissions: m.subMissions ? m.subMissions.map(sub => {
                    // ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„± ì²˜ë¦¬ (completed -> status)
                    if (sub.status) return sub;
                    return { id: sub.id || Math.random().toString(36).substr(2, 9), text: sub.text, status: sub.completed ? 'completed' : 'ready' };
                }) : [
                    { id: 'def1', text: 'ë¯¸ì…˜ ê°€ì´ë“œ í™•ì¸í•˜ê¸°', status: 'completed' },
                    { id: 'def2', text: 'ì‹¤ì²œ í›„ ì¸ì¦í•˜ê¸°', status: 'ready' }
                ]
            }));
            
            // (2) D-day ì‹¤ì‹œê°„ ê³„ì‚° ë¡œì§
            missions.forEach(m => {
                if (!m.deadline) {
                    m.deadline = Date.now() + (30 * 24 * 60 * 60 * 1000); // ê¸°ë³¸ 30ì¼
                }
                
                const now = new Date();
                now.setHours(0, 0, 0, 0);
                
                const deadline = new Date(m.deadline);
                deadline.setHours(0, 0, 0, 0);

                const diffTime = deadline - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                m.dday = diffDays > 0 ? `D-${diffDays}` : (diffDays === 0 ? 'D-Day' : 'ì¢…ë£Œ');
            });

            // í†µê³„ ê³„ì‚°
            const ongoingMissions = missions.filter(m => m.progress < 100);
            const ongoingMissionCount = ongoingMissions.length;
            
            let totalSubMissions = 0;
            let completedSubMissions = 0;
            let activeSubMissions = 0;

            missions.forEach(m => {
                if (m.subMissions) {
                    m.subMissions.forEach(sub => {
                        totalSubMissions++;
                        if (sub.status === 'completed') completedSubMissions++;
                        if (sub.status === 'active') activeSubMissions++;
                    });
                }
            });

            const totalProgress = totalSubMissions === 0 ? 0 : Math.round((completedSubMissions / totalSubMissions) * 100);

            // í—¤ë” UI ë Œë”ë§
            if (headerMissionInfo) {
                headerMissionInfo.innerHTML = `
                    <div class="flex-1 flex items-center gap-3 bg-gray-50 dark:bg-gray-800/50 rounded-card px-3 h-9 border border-gray-100 dark:border-gray-700">
                        <div class="flex items-baseline gap-1.5 flex-shrink-0">
                            <span class="text-[11px] font-bold text-gray-500 dark:text-gray-400">AI ë¯¸ì…˜</span>
                            <span class="text-sm font-bold text-gray-900 dark:text-white leading-none">${totalProgress}%</span>
                            <span class="text-[10px] text-gray-400 leading-none">(${ongoingMissionCount}ê±´)</span>
                        </div>
                        
                        <div class="flex-1 min-w-0">
                             <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5 overflow-hidden">
                                <div class="bg-deepBlue dark:bg-blue-500 h-1.5 rounded-full" style="width: ${totalProgress}%"></div>
                            </div>
                        </div>
                    </div>

                    <button onclick="event.stopPropagation(); location.href='point_history.html'" class="flex items-center justify-center gap-1 bg-purple-50 dark:bg-purple-900/20 px-3 h-9 rounded-card hover:bg-purple-100 dark:hover:bg-purple-900/40 transition flex-shrink-0 min-w-[50px] border border-purple-100 dark:border-purple-900/30">
                        <span class="text-[10px] font-bold text-electricPurple dark:text-purple-400">P</span>
                        <span class="text-xs font-bold text-gray-900 dark:text-white">${(persona.points || 0).toLocaleString()}</span>
                    </button>
                `;
            }
            
            if (window.lucide) window.lucide.createIcons();
        }

        function toggleBalanceVisibility(event) {
            if (event) event.stopPropagation();
            const isHidden = localStorage.getItem('trustFinBalanceHidden') === 'true';
            localStorage.setItem('trustFinBalanceHidden', !isHidden);
            renderAccounts();
        }

        function renderAccounts() {
            const personaData = localStorage.getItem('trustFinPersona');
            const persona = JSON.parse(personaData);
            
            // ê³„ì¢Œ ëª©ë¡ ë Œë”ë§ ë° ì´ ìì‚° ê³„ì‚°
            const accountListEl = document.getElementById('accountList');
            let total = 0;
            const isBalanceHidden = localStorage.getItem('trustFinBalanceHidden') === 'true';
            
            // ì´ ìì‚° ê³„ì‚° (ì „ì²´ ê³„ì¢Œ)
            persona.accounts.forEach(acc => total += acc.balance);

            // ì£¼ê³„ì¢Œ(ì²« ë²ˆì§¸ ê³„ì¢Œ)ë§Œ ë Œë”ë§
            const mainAccount = persona.accounts[0];
            if (mainAccount) {
                const eyeIcon = isBalanceHidden ? 'eye-off' : 'eye';
                accountListEl.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 transition-colors">
                        <!-- ìƒë‹¨: ì´ ë³´ìœ  ìì‚° -->
                        <div class="mb-2">
                            <div class="flex items-center gap-2 mb-1">
                                <p class="text-gray-500 dark:text-gray-400 text-xs font-medium">ì´ ë³´ìœ  ìì‚°</p>
                                <button onclick="toggleBalanceVisibility(event)" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition p-0.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i data-lucide="${eyeIcon}" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <h2 class="text-xl font-bold text-gray-900 dark:text-white"><span id="totalBalance">${isBalanceHidden ? '******' : '0'}</span>ì›</h2>
                        </div>
                        
                        <!-- Divider -->
                        <div class="border-t border-gray-100 dark:border-gray-700 my-2"></div>
                        
                        <!-- í•˜ë‹¨: ì£¼ê³„ì¢Œ ì •ë³´ -->
                        <div onclick="goToAccountDetail('${mainAccount.bank}')" class="flex justify-between items-center cursor-pointer active:opacity-90 transition-opacity">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-xl bg-gray-50 dark:bg-gray-700 flex items-center justify-center border border-gray-100 dark:border-gray-600 overflow-hidden">
                                    <img src="${getBankLogoUrl(mainAccount.bank)}" onerror="handleImageError(this, '${mainAccount.bank[0]}')" class="w-full h-full object-cover" alt="${mainAccount.bank}">
                                </div>
                                <div>
                                    <div class="flex items-center gap-2 mb-0.5">
                                        <span class="text-xs font-bold text-gray-900 dark:text-white">${mainAccount.bank}</span>
                                        <span class="text-[10px] text-gray-400 tracking-tight">${mainAccount.accountNumber}</span>
                                        <span class="text-[8px] font-bold text-deepBlue bg-blue-50 dark:bg-blue-900/30 dark:text-blue-300 px-1.5 py-0.5 rounded">ì£¼ê³„ì¢Œ</span>
                                    </div>
                                    <p class="font-bold text-gray-900 dark:text-white text-sm">
                                        ${isBalanceHidden 
                                            ? '<span>******</span>' 
                                            : `<span class="count-up" data-value="${mainAccount.balance}">0</span>`
                                        }ì›
                                    </p>
                                </div>
                            </div>
                            <button onclick="openTransferModal('${mainAccount.bank}', event)" class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-[10px] font-bold px-3 py-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition">ì†¡ê¸ˆ</button>
                        </div>
                    </div>
                `;
            } else {
                accountListEl.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 text-center">
                        <div class="w-16 h-16 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400 dark:text-gray-500">
                            <i data-lucide="wallet" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-sm font-bold text-gray-900 dark:text-white mb-2">ê³„ì¢Œë¥¼ ê°œì„¤í•´ë³´ì„¸ìš”</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-6">TrustFinì˜ íˆ¬ëª…í•œ ê¸ˆìœµ ì„œë¹„ìŠ¤ë¥¼<br>ê²½í—˜í•´ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <button onclick="alert('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.')" class="w-full bg-deepBlue text-white font-bold py-3 rounded-card hover:bg-blue-800 transition">
                            ê³„ì¢Œ ê°œì„¤í•˜ê¸°
                        </button>
                    </div>
                `;
            }

            // Apply Animation
            if (!isBalanceHidden) {
                animateCountUp(document.getElementById('totalBalance'), total);
                
                document.querySelectorAll('.count-up').forEach(el => {
                    animateCountUp(el, parseInt(el.dataset.value));
                });
            }
            
            if (window.lucide) window.lucide.createIcons();
        }

        function renderCreditScore() {
            const personaData = localStorage.getItem('trustFinPersona');
            const toggleBtn = document.getElementById('creditScoreToggleBtn');

            if (personaData) {
                const persona = JSON.parse(personaData);
                
                // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì²˜ë¦¬
                if (persona.id === 'guest') {
                    if (toggleBtn) toggleBtn.style.display = 'none';
                    const section = document.getElementById('creditScoreSection');
                    const tipBanner = document.getElementById('creditScoreTipBanner');
                    
                    if (section) {
                        section.innerHTML = `
                            <div class="w-full bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 text-center">
                                <div class="w-16 h-16 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400 dark:text-gray-500">
                                    <i data-lucide="shield-alert" class="w-8 h-8"></i>
                                </div>
                                <h3 class="text-sm font-bold text-gray-900 dark:text-white mb-2">ì‹ ìš©ì ìˆ˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mb-6">ê°„í¸ ì¸ì¦ìœ¼ë¡œ ë‚´ ì‹ ìš©ì ìˆ˜ë¥¼<br>ë¬´ë£Œë¡œ ì¡°íšŒí•´ë³´ì„¸ìš”.</p>
                                <button onclick="alert('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.')" class="w-full bg-black text-white font-bold py-3 rounded-card hover:bg-gray-700 transition">
                                    ë‚´ ì‹ ìš©ì ìˆ˜ ì¡°íšŒí•˜ê¸°
                                </button>
                            </div>
                        `;
                        section.classList.remove('flex', 'gap-3');
                    }
                    if (tipBanner) tipBanner.style.display = 'none';
                    lucide.createIcons();
                    return;
                }

                if (toggleBtn) {
                    toggleBtn.style.display = 'inline-flex';
                    const isHidden = localStorage.getItem('trustFinCreditScoreHidden') === 'true';
                    const iconName = isHidden ? 'eye-off' : 'eye';
                    toggleBtn.innerHTML = `<i data-lucide="${iconName}" class="w-4 h-4"></i>`;
                }

                const score = persona.creditScore || 0;
                const niceScore = Math.max(0, score - 15); // NICE ì ìˆ˜ëŠ” ì„ì˜ë¡œ KCBë³´ë‹¤ ì¡°ê¸ˆ ë‚®ê²Œ ì„¤ì •
                
                // ì ìˆ˜ ë³€ë™ ë°°ì§€ ì—…ë°ì´íŠ¸ (ì‹œë®¬ë ˆì´ì…˜ ê°’)
                updateChangeBadge('kcbChangeBadge', 15);
                updateChangeBadge('niceChangeBadge', -5);

                const isHidden = localStorage.getItem('trustFinCreditScoreHidden') === 'true';

                // ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜
                const scoreElKCB = document.getElementById('myCreditScoreKCB');
                const scoreElNICE = document.getElementById('myCreditScoreNICE');
                
                if (isHidden) {
                    if (scoreElKCB) scoreElKCB.innerText = '***';
                    if (scoreElNICE) scoreElNICE.innerText = '***';
                } else {
                    if (scoreElKCB) animateCountUp(scoreElKCB, score);
                    if (scoreElNICE) animateCountUp(scoreElNICE, niceScore);
                }
                
                // ìƒìœ„ % ê³„ì‚° (ì‹œë®¬ë ˆì´ì…˜)
                const calculatePercentile = (s) => {
                    if (s >= 950) return 1;
                    if (s >= 900) return 4;
                    if (s >= 850) return 10;
                    if (s >= 800) return 18;
                    if (s >= 750) return 28;
                    if (s >= 700) return 39;
                    if (s >= 600) return 55;
                    return 80;
                };

                const percentKCB = document.getElementById('creditScorePercentKCB');
                const percentNICE = document.getElementById('creditScorePercentNICE');
                
                if (isHidden) {
                    if (percentKCB) percentKCB.innerText = '**';
                    if (percentNICE) percentNICE.innerText = '**';
                } else {
                    if (percentKCB) percentKCB.innerText = calculatePercentile(score);
                    if (percentNICE) percentNICE.innerText = calculatePercentile(niceScore);
                }

                // ì ìˆ˜ êµ¬ê°„ë³„ ìƒ‰ìƒ ê²°ì • í•¨ìˆ˜
                const getScoreColorClass = (s) => {
                    if (s >= 900) return 'bg-emerald-500';
                    if (s >= 800) return 'bg-blue-500';
                    if (s >= 700) return 'bg-amber-500';
                    if (s >= 600) return 'bg-orange-500';
                    return 'bg-rose-500';
                };

                // ë°” ì• ë‹ˆë©”ì´ì…˜
                setTimeout(() => {
                    const barKCB = document.getElementById('creditScoreBarKCB');
                    const barNICE = document.getElementById('creditScoreBarNICE');
                    if (barKCB) {
                        if (isHidden) {
                            barKCB.className = `h-1.5 rounded-full transition-all duration-1000 bg-gray-200 dark:bg-gray-700`;
                            barKCB.style.width = '0%';
                        } else {
                            const percent = Math.min(100, (score / 1000) * 100);
                            barKCB.className = `h-1.5 rounded-full transition-all duration-1000 ${getScoreColorClass(score)}`;
                            barKCB.style.width = `${percent}%`;
                        }
                    }
                    if (barNICE) {
                        if (isHidden) {
                            barNICE.className = `h-1.5 rounded-full transition-all duration-1000 bg-gray-200 dark:bg-gray-700`;
                            barNICE.style.width = '0%';
                        } else {
                            const percent = Math.min(100, (niceScore / 1000) * 100);
                            barNICE.className = `h-1.5 rounded-full transition-all duration-1000 ${getScoreColorClass(niceScore)}`;
                            barNICE.style.width = `${percent}%`;
                        }
                    }
                }, 300);
                
                if (window.lucide) window.lucide.createIcons();
            }
        }

        function updateChangeBadge(elementId, change) {
            const el = document.getElementById(elementId);
            if (!el) return;

            let colorClass = '';
            let icon = '';
            let text = Math.abs(change);

            if (change > 0) {
                colorClass = 'text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20 dark:text-emerald-400';
                icon = 'trending-up';
            } else if (change < 0) {
                colorClass = 'text-rose-600 bg-rose-50 dark:bg-rose-900/20 dark:text-rose-400';
                icon = 'trending-down';
            } else {
                colorClass = 'text-gray-500 bg-gray-100 dark:bg-gray-700 dark:text-gray-400';
                icon = 'minus';
                text = 'ë³€ë™ ì—†ìŒ';
            }

            el.className = `text-xs font-bold px-2 py-1 rounded flex items-center gap-0.5 ${colorClass}`;
            el.innerHTML = `<i data-lucide="${icon}" class="w-3 h-3"></i> ${text}`;
        }

        function toggleSpendingVisibility(event) {
            if (event) event.stopPropagation();
            const isHidden = localStorage.getItem('trustFinSpendingHidden') === 'true';
            localStorage.setItem('trustFinSpendingHidden', !isHidden);
            renderMySpending();
        }

        function toggleCreditScoreVisibility(event) {
            if (event) event.stopPropagation();
            const isHidden = localStorage.getItem('trustFinCreditScoreHidden') === 'true';
            localStorage.setItem('trustFinCreditScoreHidden', !isHidden);
            renderCreditScore();
        }

        function renderMySpending() {
            const personaData = localStorage.getItem('trustFinPersona');
            const persona = JSON.parse(personaData || '{}');
            const section = document.getElementById('spendingSection');
            
            if (!section) return;

            // ê²ŒìŠ¤íŠ¸ì´ê±°ë‚˜ ê³„ì¢Œê°€ ì—†ëŠ” ê²½ìš°
            if (!persona.accounts || persona.accounts.length === 0 || persona.id === 'guest') {
                section.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 text-center">
                        <div class="w-16 h-16 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400 dark:text-gray-500">
                            <i data-lucide="credit-card" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-sm font-bold text-gray-900 dark:text-white mb-2">ì†Œë¹„ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-6">ì¹´ë“œë¥¼ ì—°ê²°í•˜ê³  ë˜‘ë˜‘í•œ ì†Œë¹„ ê´€ë¦¬ë¥¼<br>ì‹œì‘í•´ë³´ì„¸ìš”.</p>
                        <button onclick="alert('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.')" class="w-full bg-black text-white font-bold py-3 rounded-card hover:bg-gray-700 transition">
                            ì¹´ë“œ ì—°ê²°í•˜ê¸°
                        </button>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            // ê°€ìƒ ë°ì´í„° (ì‹¤ì œë¡œëŠ” ì„œë²„/DBì—ì„œ ê°€ì ¸ì˜´)
            const currentMonth = 1250000;
            const lastMonth = 1100000; // ì•½ 13.6% ì¦ê°€
            const budget = 2000000;

            const diff = currentMonth - lastMonth;
            const percent = Math.round((diff / lastMonth) * 100);
            
            let badgeClass = '';
            let sign = '';

            if (diff > 0) {
                badgeClass = 'text-red-500 bg-red-50 dark:bg-red-900/30 dark:text-red-400';
                sign = '+';
            } else if (diff < 0) {
                badgeClass = 'text-blue-500 bg-blue-50 dark:bg-blue-900/30 dark:text-blue-400';
                sign = '';
            } else {
                badgeClass = 'text-gray-500 bg-gray-100 dark:bg-gray-700 dark:text-gray-400';
                sign = '';
            }
            
            const budgetPercent = Math.min(100, Math.round((currentMonth / budget) * 100));
            
            // ì˜ˆì‚° ëŒ€ë¹„ ì‚¬ìš©ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì •
            let progressColor = 'bg-emerald-500';
            let warningIcon = '';
            if (budgetPercent >= 90) {
                progressColor = 'bg-rose-500';
                warningIcon = `<button onclick="showSpendingTooltip(event)" class="ml-1 focus:outline-none"><i data-lucide="alert-triangle" class="w-3 h-3 text-rose-500 animate-pulse"></i></button>`;
            } else if (budgetPercent >= 70) {
                progressColor = 'bg-amber-500';
            } else if (budgetPercent >= 50) {
                progressColor = 'bg-blue-500';
            }

            const isSpendingHidden = localStorage.getItem('trustFinSpendingHidden') === 'true';
            const eyeIcon = isSpendingHidden ? 'eye-off' : 'eye';

            const html = `
                <div onclick="openSpendingModal()" class="bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 transition-colors cursor-pointer active:scale-95 transform transition-transform">
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-500 dark:text-gray-400">ì´ë²ˆ ë‹¬ ì´ ì†Œë¹„</span>
                            <button onclick="toggleSpendingVisibility(event)" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition p-0.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i data-lucide="${eyeIcon}" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <span class="text-xs font-bold ${badgeClass} px-2 py-1 rounded">${sign}${percent}%</span>
                    </div>
                    <h2 onclick="location.href='my_spending.html'; event.stopPropagation();" class="text-xl font-bold text-gray-900 dark:text-white hover:text-deepBlue dark:hover:text-blue-400 transition-colors cursor-pointer inline-block">
                        ${isSpendingHidden ? '******' : currentMonth.toLocaleString() + 'ì›'}
                    </h2>
                    <div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2 mt-4 overflow-hidden">
                        <div id="spendingProgressBar" class="${progressColor} h-2 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                    </div>
                    <p class="text-[10px] text-gray-400 mt-2 flex items-center">ì˜ˆì‚° ëŒ€ë¹„ ${budgetPercent}% ì‚¬ìš© ${warningIcon}</p>
                </div>
            `;
            
            if (section) {
                section.innerHTML = html;
                setTimeout(() => {
                    const bar = document.getElementById('spendingProgressBar');
                    if (bar) bar.style.width = `${budgetPercent}%`;
                }, 500);
                if (window.lucide) window.lucide.createIcons();
            }
        }

        function showSpendingTooltip(event) {
            event.stopPropagation(); // ë¶€ëª¨ í´ë¦­ ë°©ì§€
            const tooltip = document.getElementById('spendingTooltip');
            const target = event.currentTarget;
            const rect = target.getBoundingClientRect();
            
            // ì•„ì´ì½˜ ìœ„ ì¤‘ì•™ì— ìœ„ì¹˜
            tooltip.style.top = `${rect.top - 8}px`;
            tooltip.style.left = `${rect.left + (rect.width / 2)}px`;
            tooltip.classList.remove('opacity-0', 'pointer-events-none');
            
            // 2ì´ˆ í›„ ìˆ¨ê¹€
            if (window.spendingTooltipTimeout) clearTimeout(window.spendingTooltipTimeout);
            window.spendingTooltipTimeout = setTimeout(() => {
                tooltip.classList.add('opacity-0', 'pointer-events-none');
            }, 2000);
        }

        function animateCountUp(element, endValue) {
            const duration = 1500;
            const startTime = performance.now();
            const startValue = 0;
            let lastHapticTime = 0;

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const ease = 1 - Math.pow(1 - progress, 3); // Ease-out cubic
                
                const current = Math.floor(startValue + (endValue - startValue) * ease);
                if (element) element.innerText = current.toLocaleString();

                // ì• ë‹ˆë©”ì´ì…˜ ì§„í–‰ ì¤‘ ì¼ì • ê°„ê²©ìœ¼ë¡œ í–…í‹± í”¼ë“œë°±
                if (progress < 1 && currentTime - lastHapticTime > 80) {
                    if (navigator.vibrate) navigator.vibrate(5);
                    lastHapticTime = currentTime;
                }

                if (progress < 1) requestAnimationFrame(update);
                else if (element) element.innerText = endValue.toLocaleString();
            }
            requestAnimationFrame(update);
        }

        function renderMyLoans() {
            const loanSection = document.getElementById('loanSection');
            let allLoans = JSON.parse(localStorage.getItem('trustFinMyLoans') || '[]');
            const persona = JSON.parse(localStorage.getItem('trustFinPersona') || '{}');
            const currentPersonaId = persona.id;

            // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì²˜ë¦¬
            if (currentPersonaId === 'guest') {
                loanSection.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 text-center">
                        <div class="w-16 h-16 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400 dark:text-gray-500">
                            <i data-lucide="coins" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-sm font-bold text-gray-900 dark:text-white mb-2">ëŒ€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-6">ë‚´ ì¡°ê±´ì— ë”± ë§ëŠ” ìµœì € ê¸ˆë¦¬ ìƒí’ˆì„<br>AIê°€ íˆ¬ëª…í•˜ê²Œ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤.</p>
                        <button onclick="alert('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.')" class="w-full bg-deepBlue text-white font-bold py-3 rounded-card hover:bg-blue-800 transition">
                            ë‚´ í•œë„ ì¡°íšŒí•˜ê¸°
                        </button>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            const now = Date.now();
            let dataChanged = false;
            let showBanner = false;
            let completedProducts = [];

            // ìƒíƒœ ì—…ë°ì´íŠ¸ (1ë¶„ ê²½ê³¼ ì²´í¬) - ëª¨ë“  ëŒ€ì¶œ ë‚´ì—­ ëŒ€ìƒ
            allLoans = allLoans.map(loan => {
                if (loan.status === 'pending') {
                    if (now - loan.timestamp > 60000) { // 1ë¶„(60000ms) ê²½ê³¼
                        loan.status = 'approved';
                        dataChanged = true;
                        if (loan.personaId === currentPersonaId) {
                            showBanner = true;
                            completedProducts.push(loan);
                        }
                    }
                }
                return loan;
            });

            if (dataChanged) {
                localStorage.setItem('trustFinMyLoans', JSON.stringify(allLoans));

                // ì‹¬ì‚¬ ì™„ë£Œ ì•Œë¦¼ ì¶”ê°€
                if (completedProducts.length > 0) {
                    const notifications = JSON.parse(localStorage.getItem('trustFinNotifications') || '[]');
                    const date = new Date();
                    const dateStr = `${date.getMonth() + 1}.${date.getDate()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                    
                    completedProducts.forEach(loan => {
                        notifications.unshift({
                            type: 'loan',
                            title: 'ëŒ€ì¶œ ì‹¬ì‚¬ ì™„ë£Œ',
                            message: `'${loan.productName}' ì‹¬ì‚¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`,
                            date: dateStr,
                            productId: loan.id,
                            read: false
                        });
                    });
                    localStorage.setItem('trustFinNotifications', JSON.stringify(notifications));
                }

                if (showBanner) {
                    const msg = completedProducts.length === 1 
                        ? `'${completedProducts[0].productName}' ì‹¬ì‚¬ ì™„ë£Œ` 
                        : `${completedProducts.length}ê±´ì˜ ì‹¬ì‚¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    showToast(msg);
                    updateNotificationBadge(); // ì•Œë¦¼ ë±ƒì§€ ê°±ì‹ 
                }
            }

            // í˜„ì¬ í¼ì†Œë‚˜ì˜ ëŒ€ì¶œ ë‚´ì—­ë§Œ í•„í„°ë§
            const myLoans = allLoans.filter(loan => loan.personaId === currentPersonaId);

            // ìµœì‹ ìˆœ ì •ë ¬ (ë°©ê¸ˆ ì‹ ì²­í•œ ìƒí’ˆì´ ìµœìƒë‹¨ì— ì˜¤ë„ë¡ ë³´ì¥)
            myLoans.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
            
            // ì´ ëŒ€ì¶œ ì”ì•¡ ê³„ì‚° (ì‹œë®¬ë ˆì´ì…˜)
            let totalBalance = 0;
            let activeCount = 0;
            myLoans.forEach(loan => {
                if (loan.status === 'active') {
                    totalBalance += 30000000; // ê±´ë‹¹ 3,000ë§Œì› ê°€ì •
                    activeCount++;
                }
            });

            // ë Œë”ë§
            if (myLoans.length === 0) {
                loanSection.innerHTML = `
                    <div class="bg-gray-900 dark:bg-white rounded-card p-4 shadow-lg text-white dark:text-gray-900">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="bg-white/10 dark:bg-gray-900/10 p-3 rounded-full text-white dark:text-gray-900 backdrop-blur-sm">
                                <i data-lucide="sparkles" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm">AI ë§ì¶¤ ëŒ€ì¶œ ì¶”ì²œ</h4>
                                <p class="text-[10px] text-gray-400 dark:text-gray-600 mt-1">ë‚´ ì¡°ê±´ì— ë”± ë§ëŠ” ìµœì € ê¸ˆë¦¬ ìƒí’ˆì„<br>AIê°€ íˆ¬ëª…í•˜ê²Œ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <button onclick="location.href='loan_input.html'" class="w-full bg-white dark:bg-gray-900 text-gray-900 dark:text-white font-bold py-3 rounded-card hover:bg-gray-100 dark:hover:bg-gray-800 transition active:scale-95 flex justify-center items-center gap-2 shadow-sm">
                            <span>ëŒ€ì¶œë°›ê¸°</span>
                            <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
            } else {
                loanSection.innerHTML = `
                    <div onclick="location.href='my_loans.html'" class="bg-white dark:bg-gray-800 rounded-card p-4 shadow-lg border border-gray-100 dark:border-gray-700 transition-colors cursor-pointer active:scale-95 transform transition-transform">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs text-gray-500 dark:text-gray-400">ì´ ëŒ€ì¶œ ì”ì•¡</span>
                            <span class="text-xs font-bold text-white bg-black dark:bg-gray-700 px-2 py-1 rounded">ë³´ìœ  ${myLoans.length}ê±´</span>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">${totalBalance.toLocaleString()}ì›</h2>
                        <div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2 mt-4 overflow-hidden">
                            <div class="bg-black dark:bg-white h-2 rounded-full" style="width: ${totalBalance > 0 ? '60%' : '0%'}"></div>
                        </div>
                        <p class="text-[10px] text-gray-400 mt-2">
                            ${activeCount > 0 ? 'ì •ìƒ ì´ìš© ì¤‘ì…ë‹ˆë‹¤.' : 'ì‹¬ì‚¬ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.'}
                        </p>
                    </div>
                `;
            }
            lucide.createIcons();

            // ì‹¬ì‚¬ ì¤‘ì¸ í•­ëª©ì´ ìˆìœ¼ë©´ 1ì´ˆ ë’¤ ì¬ê²€ì‚¬
            const hasPending = myLoans.some(loan => loan.status === 'pending');
            if (hasPending) {
                setTimeout(renderMyLoans, 1000);
            }
        }

        function showToast(message) {
            const toast = document.getElementById('topToast');
            const text = document.getElementById('toastText');
            
            text.innerText = message;
            toast.classList.remove('-translate-y-24', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('-translate-y-24', 'opacity-0');
            }, 3000);
        }

        let progressInterval;

        function openProgressModal(productName, timestamp) {
            const modal = document.getElementById('progressModal');
            const nameEl = document.getElementById('progressProductName');
            const bar = document.getElementById('progressBar');
            const percentEl = document.getElementById('progressPercent');

            nameEl.innerText = productName;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ì ê¸ˆ
            toggleBackgroundScale(true);
            
            // UI ì´ˆê¸°í™”
            updateProgressUI(0);

            if (progressInterval) clearInterval(progressInterval);
            
            // ì‹¤ì œ ê²½ê³¼ ì‹œê°„ ê¸°ë°˜ ì• ë‹ˆë©”ì´ì…˜
            progressInterval = setInterval(() => {
                const now = Date.now();
                const elapsed = now - timestamp;
                const duration = 60000; // 1ë¶„ (60ì´ˆ)
                
                let percent = Math.floor((elapsed / duration) * 100);
                if (percent > 100) percent = 100;
                if (percent < 0) percent = 0;

                updateProgressUI(percent);

                if (percent >= 100) {
                    clearInterval(progressInterval);
                    setTimeout(() => {
                        closeProgressModal();
                        renderMyLoans(); // ì™„ë£Œ ìƒíƒœë¡œ ê°±ì‹ 
                    }, 800);
                }
            }, 100);
        }

        function updateProgressUI(percent) {
            const bar = document.getElementById('progressBar');
            const percentEl = document.getElementById('progressPercent');
            
            if (bar) bar.style.width = `${percent}%`;
            if (percentEl) percentEl.innerText = `${percent}%`;

            // ë‹¨ê³„ë³„ UI ì—…ë°ì´íŠ¸
            const steps = [
                { id: 'step1', threshold: 15, text: 'ì‹ ìš©ì ìˆ˜ ì¡°íšŒ' },
                { id: 'step2', threshold: 50, text: 'ì†Œë“ ì •ë³´ í™•ì¸' },
                { id: 'step3', threshold: 85, text: 'ìµœì¢… í•œë„ ì‚°ì¶œ' }
            ];

            steps.forEach(step => {
                const el = document.getElementById(step.id);
                const iconBox = el.querySelector('.icon-box');
                const textSpan = el.querySelector('span');

                if (percent >= step.threshold) {
                    el.classList.remove('opacity-50');
                    el.classList.add('text-deepBlue', 'dark:text-blue-400', 'font-bold');
                    iconBox.innerHTML = `<i data-lucide="check-circle-2" class="w-4 h-4 text-green-500"></i>`;
                    textSpan.innerText = `${step.text} ì™„ë£Œ`;
                } else if (percent >= step.threshold - 15) {
                    // ì§„í–‰ ì¤‘ (ì§ì „ ë‹¨ê³„)
                    el.classList.remove('opacity-50');
                    el.classList.add('text-gray-900', 'dark:text-white');
                    iconBox.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin text-deepBlue dark:text-blue-400"></i>`;
                    textSpan.innerText = `${step.text} ì¤‘...`;
                } else {
                    // ëŒ€ê¸°
                    el.classList.add('opacity-50');
                    el.classList.remove('text-deepBlue', 'dark:text-blue-400', 'font-bold', 'text-gray-900', 'dark:text-white');
                    iconBox.innerHTML = `<i data-lucide="circle" class="w-4 h-4"></i>`;
                    textSpan.innerText = step.text;
                }
            });
            
            if (window.lucide) window.lucide.createIcons();
        }

        function closeProgressModal(animate = true) {
            const modal = document.getElementById('progressModal');
            const content = modal.querySelector('.bg-white');
            
            if (animate) {
                content.classList.remove('animate-slide-up');
                content.classList.add('animate-slide-down');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    content.classList.remove('animate-slide-down');
                    document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ì ê¸ˆ í•´ì œ
                    toggleBackgroundScale(false);
                }, 300);
            } else {
                modal.classList.add('hidden');
                document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ì ê¸ˆ í•´ì œ
                toggleBackgroundScale(false);
            }
            if (progressInterval) clearInterval(progressInterval);
        }

        function openCreditScoreModal(scrollToTip = false) {
            const modal = document.getElementById('creditScoreModal');
            const content = modal.querySelector('.bg-white');
            
            content.classList.add('animate-slide-up');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            toggleBackgroundScale(true);
            
            // ì´ˆê¸° íƒ­ ì„¤ì • (KCB)
            switchCreditScoreTab('kcb');
            // renderScoreTrendChart('kcb'); // switchCreditScoreTab ë‚´ë¶€ì—ì„œ í˜¸ì¶œë¨
            
            // íŒ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            if (scrollToTip) {
                setTimeout(() => {
                    const tipSection = document.getElementById('creditScoreTip');
                    if (tipSection) {
                        tipSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        // ê°•ì¡° íš¨ê³¼
                        tipSection.classList.add('ring-2', 'ring-blue-500', 'dark:ring-blue-400');
                        setTimeout(() => tipSection.classList.remove('ring-2', 'ring-blue-500', 'dark:ring-blue-400'), 1500);
                    }
                }, 400); // ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ í›„ ì‹¤í–‰
            }
            
            lucide.createIcons();
        }

        function switchCreditScoreTab(tab) {
            const personaData = localStorage.getItem('trustFinPersona');
            let score = 0;
            if (personaData) {
                const persona = JSON.parse(personaData);
                score = persona.creditScore || 0;
            }
            
            // KCB vs NICE ë°ì´í„° ì„¤ì •
            let displayScore = score;
            let agencyText = 'KCB ì˜¬í¬ë ˆë”§ ê¸°ì¤€';
            let changeText = 'ì§€ë‚œë‹¬ë³´ë‹¤ 15ì  ìƒìŠ¹';
            let changeColor = 'text-green-600 dark:text-green-400';
            let changeIcon = 'trending-up';

            if (tab === 'nice') {
                displayScore = Math.max(0, score - 15);
                agencyText = 'NICE í‰ê°€ì •ë³´ ê¸°ì¤€';
                changeText = 'ì§€ë‚œë‹¬ë³´ë‹¤ 5ì  í•˜ë½';
                changeColor = 'text-blue-600 dark:text-blue-400';
                changeIcon = 'trending-down';
            }

            // ì ìˆ˜ êµ¬ê°„ë³„ ìƒ‰ìƒ ê²°ì • í•¨ìˆ˜ (Cardì™€ ë™ì¼ ë¡œì§)
            const getScoreColorClass = (s) => {
                if (s >= 900) return 'bg-emerald-500';
                if (s >= 800) return 'bg-blue-500';
                if (s >= 700) return 'bg-amber-500';
                if (s >= 600) return 'bg-orange-500';
                return 'bg-rose-500';
            };

            const isHidden = localStorage.getItem('trustFinCreditScoreHidden') === 'true';

            // UI ì—…ë°ì´íŠ¸
            if (isHidden) {
                document.getElementById('modalCreditScore').innerText = '***';
            } else {
                document.getElementById('modalCreditScore').innerText = displayScore;
            }
            document.getElementById('modalScoreAgency').innerText = agencyText;
            
            const changeEl = document.getElementById('modalScoreChange');
            if (isHidden) {
                changeEl.className = `text-gray-400 font-bold flex items-center justify-center gap-1`;
                changeEl.innerHTML = `<span>-</span>`;
            } else {
                changeEl.className = `${changeColor} font-bold flex items-center justify-center gap-1`;
                changeEl.innerHTML = `<i data-lucide="${changeIcon}" class="w-4 h-4"></i> ${changeText}`;
            }

            // íƒ­ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            const kcbTab = document.getElementById('tab-kcb');
            const niceTab = document.getElementById('tab-nice');
            const activeClass = 'bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm';
            const inactiveClass = 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200';

            if (tab === 'kcb') {
                kcbTab.className = `flex-1 py-2 text-sm font-bold rounded-card transition-all ${activeClass}`;
                niceTab.className = `flex-1 py-2 text-sm font-bold rounded-card transition-all ${inactiveClass}`;
            } else {
                kcbTab.className = `flex-1 py-2 text-sm font-bold rounded-card transition-all ${inactiveClass}`;
                niceTab.className = `flex-1 py-2 text-sm font-bold rounded-card transition-all ${activeClass}`;
            }

            // ìƒì„¸ í‰ê°€ í•­ëª© ì—…ë°ì´íŠ¸
            const analysisItems = document.getElementById('scoreAnalysisItems');
            if (tab === 'kcb') {
                analysisItems.innerHTML = `
                    <div onclick="openScoreCriteriaModal('payment')" class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-card flex justify-between items-center cursor-pointer active:scale-95 transition-transform">
                        <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-deepBlue dark:text-blue-400"><i data-lucide="calendar-check" class="w-5 h-5"></i></div><div><p class="text-xs font-bold text-gray-900 dark:text-white">ìƒí™˜ ì´ë ¥</p><p class="text-[10px] text-gray-500 dark:text-gray-400">ì—°ì²´ ì—†ì´ ì„±ì‹¤í•˜ê²Œ ìƒí™˜ ì¤‘</p></div></div><span class="text-xs font-bold text-deepBlue dark:text-blue-400">ìš°ìˆ˜</span>
                    </div>
                    <div onclick="openScoreCriteriaModal('debt')" class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-card flex justify-between items-center cursor-pointer active:scale-95 transition-transform">
                        <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-electricPurple dark:text-purple-400"><i data-lucide="credit-card" class="w-5 h-5"></i></div><div><p class="text-xs font-bold text-gray-900 dark:text-white">ë¶€ì±„ ìˆ˜ì¤€</p><p class="text-[10px] text-gray-500 dark:text-gray-400">ì†Œë“ ëŒ€ë¹„ ì ì ˆí•œ ìˆ˜ì¤€</p></div></div><span class="text-xs font-bold text-electricPurple dark:text-purple-400">ì–‘í˜¸</span>
                    </div>
                `;
            } else {
                analysisItems.innerHTML = `
                    <div onclick="openScoreCriteriaModal('payment')" class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-card flex justify-between items-center cursor-pointer active:scale-95 transition-transform">
                        <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-deepBlue dark:text-blue-400"><i data-lucide="calendar-check" class="w-5 h-5"></i></div><div><p class="text-xs font-bold text-gray-900 dark:text-white">ìƒí™˜ ì´ë ¥</p><p class="text-[10px] text-gray-500 dark:text-gray-400">ìµœê·¼ 1ë…„ ì—°ì²´ ê¸°ë¡ ì—†ìŒ</p></div></div><span class="text-xs font-bold text-electricPurple dark:text-purple-400">ì–‘í˜¸</span>
                    </div>
                    <div onclick="openScoreCriteriaModal('creditType')" class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-card flex justify-between items-center cursor-pointer active:scale-95 transition-transform">
                        <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400"><i data-lucide="credit-card" class="w-5 h-5"></i></div><div><p class="text-xs font-bold text-gray-900 dark:text-white">ì‹ ìš© í˜•íƒœ</p><p class="text-[10px] text-gray-500 dark:text-gray-400">ì²´í¬ì¹´ë“œ ì‚¬ìš© ë¹„ì¤‘ ë†’ìŒ</p></div></div><span class="text-xs font-bold text-deepBlue dark:text-blue-400">ìš°ìˆ˜</span>
                    </div>
                `;
            }

            // ë°” ì• ë‹ˆë©”ì´ì…˜
            const bar = document.getElementById('modalScoreBar');
            if (bar) {
                if (isHidden) {
                    bar.className = "absolute top-0 left-0 h-full bg-gray-200 dark:bg-gray-700 transition-all duration-1000";
                    bar.style.width = '0%';
                } else {
                    bar.className = `absolute top-0 left-0 h-full transition-all duration-1000 ${getScoreColorClass(displayScore)}`;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        const percent = Math.min(100, (displayScore / 1000) * 100);
                        bar.style.width = `${percent}%`;
                    }, 100);
                }
            }

            renderScoreTrendChart(tab);
            
            lucide.createIcons();
        }

        function closeCreditScoreModal(animate = true) {
            const modal = document.getElementById('creditScoreModal');
            const content = modal.querySelector('.bg-white');
            
            if (animate) {
                content.classList.remove('animate-slide-up');
                content.classList.add('animate-slide-down');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    content.classList.remove('animate-slide-down');
                    document.body.style.overflow = '';
                    toggleBackgroundScale(false);
                    
                    // ë°” ì´ˆê¸°í™”
                    const bar = document.getElementById('modalScoreBar');
                    if (bar) bar.style.width = '0%';
                }, 300);
            } else {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                toggleBackgroundScale(false);
            }
        }

        const scoreCriteriaData = {
            payment: {
                title: "ìƒí™˜ ì´ë ¥",
                desc: "ìµœê·¼ 12ê°œì›” ë‚´ ì—°ì²´ ê¸°ë¡ ì—¬ë¶€ì™€ ì—°ì²´ ê¸°ê°„, ê¸ˆì•¡ ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ í‰ê°€í•©ë‹ˆë‹¤. ì¥ê¸° ì—°ì²´ëŠ” ì ìˆ˜ì— í° ë¶€ì •ì  ì˜í–¥ì„ ë¯¸ì¹˜ë©°, ì„±ì‹¤í•œ ìƒí™˜ì€ ì ìˆ˜ ìƒìŠ¹ì˜ ì£¼ìš” ìš”ì¸ì…ë‹ˆë‹¤."
            },
            debt: {
                title: "ë¶€ì±„ ìˆ˜ì¤€",
                desc: "ì†Œë“ ëŒ€ë¹„ ì´ ë¶€ì±„ ìƒí™˜ ë¹„ìœ¨(DSR)ê³¼ ì‹ ìš©ëŒ€ì¶œ, ë‹´ë³´ëŒ€ì¶œì˜ ë¹„ì¤‘ì„ í‰ê°€í•©ë‹ˆë‹¤. ê³ ìœ„í—˜ ëŒ€ì¶œ(í˜„ê¸ˆì„œë¹„ìŠ¤ ë“±) ì‚¬ìš© ì‹œ ì ìˆ˜ê°€ í•˜ë½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            },
            creditType: {
                title: "ì‹ ìš© í˜•íƒœ",
                desc: "ì²´í¬ì¹´ë“œì™€ ì‹ ìš©ì¹´ë“œì˜ ì‚¬ìš© ë¹„ìœ¨, í• ë¶€ ê±°ë˜ ë¹„ì¤‘ ë“±ì„ ë¶„ì„í•©ë‹ˆë‹¤. ì²´í¬ì¹´ë“œì˜ ê¾¸ì¤€í•œ ì‚¬ìš©ì€ ê±´ì „í•œ ì†Œë¹„ ìŠµê´€ìœ¼ë¡œ í‰ê°€ë˜ì–´ ê¸ì •ì ì¸ ì˜í–¥ì„ ì¤ë‹ˆë‹¤."
            }
        };

        function openScoreCriteriaModal(type) {
            const data = scoreCriteriaData[type];
            if (!data) return;

            document.getElementById('criteriaTitle').innerText = data.title;
            document.getElementById('criteriaDesc').innerText = data.desc;
            
            const modal = document.getElementById('scoreCriteriaModal');
            const content = modal.querySelector('.bg-white');
            content.classList.add('animate-slide-up');
            modal.classList.remove('hidden');
        }

        function closeScoreCriteriaModal() {
            const modal = document.getElementById('scoreCriteriaModal');
            const content = modal.querySelector('.bg-white');
            
            content.classList.remove('animate-slide-up');
            content.classList.add('animate-slide-down');
            setTimeout(() => {
                modal.classList.add('hidden');
                content.classList.remove('animate-slide-down');
            }, 300);
        }

        function renderScoreTrendChart(type) {
            const svg = document.getElementById('scoreTrendChart');
            const labelsDiv = document.getElementById('scoreChartLabels');
            if (!svg) return;

            svg.innerHTML = '';
            labelsDiv.innerHTML = '';

            const isHidden = localStorage.getItem('trustFinCreditScoreHidden') === 'true';
            if (isHidden) {
                const width = svg.clientWidth || 300;
                const height = svg.clientHeight || 128;
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", width / 2);
                text.setAttribute("y", height / 2);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("class", "text-sm font-bold fill-gray-400 dark:fill-gray-500");
                text.textContent = "ì ìˆ˜ ìˆ¨ê¹€ ìƒíƒœ";
                svg.appendChild(text);
                return;
            }

            // Xì¶• ë ˆì´ë¸” ìƒì„± (í˜„ì¬ ì‹œì  ê¸°ì¤€ ìµœê·¼ 6ê°œì›”)
            const months = [];
            const now = new Date();
            for (let i = 5; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                months.push(`${d.getMonth() + 1}ì›”`);
            }

            let data = [];
            const personaData = localStorage.getItem('trustFinPersona');
            let currentScore = 0;
            if (personaData) {
                currentScore = JSON.parse(personaData).creditScore || 0;
            }

            if (type === 'kcb') {
                // KCB: ìƒìŠ¹ ì¶”ì„¸ ì‹œë®¬ë ˆì´ì…˜
                const base = currentScore - 20;
                data = [base, base + 5, base + 5, base + 10, base + 15, currentScore];
            } else {
                // NICE: ì•½ê°„ í•˜ë½ í›„ ìœ ì§€ ì‹œë®¬ë ˆì´ì…˜ (KCBë³´ë‹¤ ë‚®ê²Œ ì„¤ì •)
                const niceScore = Math.max(0, currentScore - 15);
                const base = niceScore + 5;
                data = [base, base, base - 5, base - 5, base - 5, niceScore];
            }

            // Mock Reasons (ë³€ë™ ì‚¬ìœ )
            const reasons = [
                'ì‹ ìš©ì¹´ë“œ ì‹ ê·œ ë°œê¸‰',
                'ëŒ€ì¶œê¸ˆ ì„±ì‹¤ ìƒí™˜',
                'ì²´í¬ì¹´ë“œ ì‚¬ìš© ì‹¤ì ',
                'í†µì‹ ë¹„ ë‚©ë¶€ ë‚´ì—­',
                'ì‹ ìš©ì¹´ë“œ í•œë„ ìƒí–¥',
                'ìµœê·¼ ê¸ˆìœµ ê±°ë˜ ì‹¤ì '
            ];

            // Chart Drawing Logic (SVG)
            const width = svg.clientWidth || 300;
            const height = svg.clientHeight || 128;
            const padding = 10;
            
            const dataMin = Math.min(...data);
            const dataMax = Math.max(...data);
            const diff = dataMax - dataMin;
            const paddingY = diff === 0 ? 5 : Math.ceil(diff * 0.05); // ë³€ë™í­ì˜ 5%ë¡œ ë” íƒ€ì´íŠ¸í•˜ê²Œ ì¡°ì •í•˜ì—¬ ë³€ë™ ê°•ì¡°
            
            const minVal = dataMin - paddingY;
            const maxVal = dataMax + paddingY;
            const range = maxVal - minVal || 1;

            const pointsArr = data.map((val, i) => {
                const x = (i / (data.length - 1)) * (width - padding * 2) + padding;
                const y = height - ((val - minVal) / range) * (height - padding * 2) - padding;
                return { x, y, val };
            });
            
            const pointsStr = pointsArr.map(p => `${p.x},${p.y}`).join(' ');

            // Gradient Defs
            const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
            
            // ì ìˆ˜ êµ¬ê°„ë³„ ì˜ì—­ ìƒ‰ìƒ ê²°ì •
            let areaColor = '#4353FF'; // Awwwards Style: Electric Blue

            defs.innerHTML = `
                <linearGradient id="scoreChartGradient" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="${areaColor}" stop-opacity="0.2"/>
                    <stop offset="100%" stop-color="${areaColor}" stop-opacity="0"/>
                </linearGradient>
            `;
            svg.appendChild(defs);

            // Area Path
            const areaPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const firstPoint = pointsStr.split(' ')[0];
            const lastPoint = pointsStr.split(' ')[pointsStr.split(' ').length - 1];
            const areaD = `M ${pointsStr} L ${lastPoint.split(',')[0]},${height} L ${firstPoint.split(',')[0]},${height} Z`;
            
            areaPath.setAttribute("d", areaD);
            areaPath.setAttribute("fill", "url(#scoreChartGradient)");
            areaPath.style.opacity = '0';
            areaPath.style.transition = 'opacity 1s ease-out';
            setTimeout(() => areaPath.style.opacity = '1', 100);
            svg.appendChild(areaPath);

            // Line Segments (Color Coded)
            for (let i = 0; i < pointsArr.length - 1; i++) {
                const p1 = pointsArr[i];
                const p2 = pointsArr[i+1];
                
                let lineColor = '#9CA3AF'; // Gray
                if (p2.val > p1.val) lineColor = '#10B981'; // Emerald (Up)
                else if (p2.val < p1.val) lineColor = '#F43F5E'; // Rose (Down)

                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", p1.x);
                line.setAttribute("y1", p1.y);
                line.setAttribute("x2", p2.x);
                line.setAttribute("y2", p2.y);
                line.setAttribute("stroke", lineColor);
                line.setAttribute("stroke-width", "3");
                line.setAttribute("stroke-linecap", "round");
                line.setAttribute("class", "opacity-0 transition-opacity duration-500");
                line.style.transitionDelay = `${i * 100}ms`;
                svg.appendChild(line);
                
                setTimeout(() => line.classList.remove("opacity-0"), 50);
            }

            // Dots
            pointsArr.forEach((p, i) => {
                let dotColor = '#9CA3AF';
                if (i > 0) {
                    if (data[i] > data[i-1]) dotColor = '#10B981'; // Emerald
                    else if (data[i] < data[i-1]) dotColor = '#F43F5E'; // Rose
                } else if (data.length > 1) {
                    if (data[1] > data[0]) dotColor = '#10B981';
                    else if (data[1] < data[0]) dotColor = '#F43F5E';
                }

                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", p.x);
                circle.setAttribute("cy", p.y);
                circle.setAttribute("r", "6");
                
                // í•˜ë½ì„¸ì¼ ê²½ìš° ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì±„ì›Œì„œ ê°•ì¡°
                if (dotColor === '#F43F5E') {
                    circle.setAttribute("fill", dotColor);
                    circle.setAttribute("stroke", "#fff");
                } else {
                    circle.setAttribute("fill", "#fff");
                    circle.setAttribute("stroke", dotColor);
                }
                
                circle.setAttribute("stroke-width", "2");
                circle.setAttribute("class", "opacity-0 transition-opacity duration-500");
                circle.style.transitionDelay = `${i * 100 + 500}ms`;
                svg.appendChild(circle);
                
                // Tooltip text (simple)
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", p.x);
                text.setAttribute("y", p.y - 10);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("fill", "currentColor"); // Uses parent text color (gray-900/white) via CSS if set, or explicit color
                // Explicitly setting class for color handling in dark mode
                text.setAttribute("class", "text-[10px] font-bold text-gray-500 dark:text-gray-300 opacity-0 transition-opacity duration-500");
                text.style.transitionDelay = `${i * 100 + 500}ms`;
                text.textContent = p.val;
                svg.appendChild(text);

                setTimeout(() => {
                    circle.classList.remove("opacity-0");
                    text.classList.remove("opacity-0");
                }, 100);

                // Hit Area for Tooltip (Clickable)
                const hitArea = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                hitArea.setAttribute("cx", p.x);
                hitArea.setAttribute("cy", p.y);
                hitArea.setAttribute("r", "20"); // Larger radius for easier clicking
                hitArea.setAttribute("fill", "transparent");
                hitArea.style.cursor = "pointer";
                hitArea.onclick = (e) => {
                    e.stopPropagation();
                    showScoreTooltip(p.x, p.y, reasons[i]);
                };
                svg.appendChild(hitArea);
            });

            // Yì¶• ë²”ìœ„ í‘œì‹œ (ìµœì†Œ/ìµœëŒ€ê°’) - ë³€ë™í­ ì‹œê°í™” ë³´ì¡°
            const rangeTextMin = document.createElementNS("http://www.w3.org/2000/svg", "text");
            rangeTextMin.setAttribute("x", 0);
            rangeTextMin.setAttribute("y", height - 2);
            rangeTextMin.setAttribute("class", "text-[8px] fill-gray-300 dark:fill-gray-600 font-medium");
            rangeTextMin.textContent = Math.floor(minVal);
            svg.appendChild(rangeTextMin);

            const rangeTextMax = document.createElementNS("http://www.w3.org/2000/svg", "text");
            rangeTextMax.setAttribute("x", 0);
            rangeTextMax.setAttribute("y", 8);
            rangeTextMax.setAttribute("class", "text-[8px] fill-gray-300 dark:fill-gray-600 font-medium");
            rangeTextMax.textContent = Math.ceil(maxVal);
            svg.appendChild(rangeTextMax);

            // X-axis Labels
            labelsDiv.innerHTML = months.map(m => `<span>${m}</span>`).join('');
        }

        function showScoreTooltip(x, y, text) {
            const tooltip = document.getElementById('scoreTooltip');
            const reasonEl = document.getElementById('tooltipReason');
            
            if (tooltip && reasonEl) {
                reasonEl.innerText = text;
                tooltip.style.left = `${x}px`;
                tooltip.style.top = `${y - 12}px`; // ì  ë°”ë¡œ ìœ„
                tooltip.classList.remove('opacity-0', 'scale-90');
                
                // 2ì´ˆ í›„ ìë™ ìˆ¨ê¹€
                if (window.scoreTooltipTimeout) clearTimeout(window.scoreTooltipTimeout);
                window.scoreTooltipTimeout = setTimeout(() => {
                    tooltip.classList.add('opacity-0', 'scale-90');
                }, 2000);
            }
        }

        function openSpendingModal() {
            const isHidden = localStorage.getItem('trustFinSpendingHidden') === 'true';
            
            // ì†Œë¹„ ì¦ê° ë°°ì§€ ë¡œì§ (renderMySpendingê³¼ ë™ì¼)
            const currentMonth = 1250000;
            const lastMonth = 1100000;
            const diff = currentMonth - lastMonth;
            const percent = Math.round((diff / lastMonth) * 100);
            
            let badgeClass = '';
            let sign = '';

            if (diff > 0) {
                badgeClass = 'text-red-500 bg-red-50 dark:bg-red-900/30 dark:text-red-400';
                sign = '+';
            } else if (diff < 0) {
                badgeClass = 'text-blue-500 bg-blue-50 dark:bg-blue-900/30 dark:text-blue-400';
                sign = '';
            } else {
                badgeClass = 'text-gray-500 bg-gray-100 dark:bg-gray-700 dark:text-gray-400';
                sign = '';
            }

            const badgeEl = document.getElementById('spendingModalBadge');
            if (badgeEl) {
                badgeEl.className = `text-xs font-bold px-2 py-1 rounded ${badgeClass}`;
                badgeEl.innerText = `${sign}${percent}%`;
                badgeEl.classList.remove('hidden');
            }
            
            // Update amounts based on visibility
            const amounts = [
                { id: 'spendingModalItem1Amount', value: '812,500ì›' },
                { id: 'spendingModalItem2Amount', value: '250,000ì›' },
                { id: 'spendingModalItem3Amount', value: '187,500ì›' },
                { id: 'spendingModalTotalAmount', value: '1,250,000ì›' }
            ];

            amounts.forEach(item => {
                const el = document.getElementById(item.id);
                if (el) el.innerText = isHidden ? '******' : item.value;
            });
            
            // Calculate and update category changes
            const changes = [
                { id: 'spendingModalItem1Change', current: 812500, last: 700000 }, // ì‡¼í•‘
                { id: 'spendingModalItem2Change', current: 250000, last: 250000 }, // ì‹ë¹„
                { id: 'spendingModalItem3Change', current: 187500, last: 150000 }  // êµí†µ
            ];

            changes.forEach(item => {
                const el = document.getElementById(item.id);
                if (el) {
                    if (isHidden) {
                        el.innerText = '';
                        return;
                    }
                    const diff = item.current - item.last;
                    const percent = item.last === 0 ? 0 : Math.round((diff / item.last) * 100);
                    
                    if (diff > 0) {
                        el.className = 'text-[10px] font-bold text-red-500 dark:text-red-400';
                        el.innerText = `+${percent}%`;
                    } else if (diff < 0) {
                        el.className = 'text-[10px] font-bold text-blue-500 dark:text-blue-400';
                        el.innerText = `${percent}%`;
                    } else {
                        el.className = 'text-[10px] font-bold text-gray-400';
                        el.innerText = `-`;
                    }
                }
            });
            
            // Total Change Text
            const totalChangeEl = document.getElementById('spendingModalTotalChange');
            if (totalChangeEl) {
                if (isHidden) {
                    totalChangeEl.innerText = '';
                } else {
                    if (diff > 0) {
                        totalChangeEl.className = 'text-xs font-bold text-red-500 dark:text-red-400 mt-0.5';
                        totalChangeEl.innerText = `ì „ì›” ëŒ€ë¹„ +${percent}%`;
                    } else if (diff < 0) {
                        totalChangeEl.className = 'text-xs font-bold text-blue-500 dark:text-blue-400 mt-0.5';
                        totalChangeEl.innerText = `ì „ì›” ëŒ€ë¹„ ${percent}%`;
                    } else {
                        totalChangeEl.className = 'text-xs font-bold text-gray-400 mt-0.5';
                        totalChangeEl.innerText = `ì „ì›”ê³¼ ë™ì¼`;
                    }
                }
            }

            const modal = document.getElementById('spendingModal');
            const content = modal.querySelector('.bg-white');
            content.classList.add('animate-slide-up');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ì ê¸ˆ
            toggleBackgroundScale(true);
            lucide.createIcons();
        }

        function closeSpendingModal(animate = true) {
            const modal = document.getElementById('spendingModal');
            const content = modal.querySelector('.bg-white');
            
            if (animate) {
                content.classList.remove('animate-slide-up');
                content.classList.add('animate-slide-down');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    content.classList.remove('animate-slide-down');
                    document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ì ê¸ˆ í•´ì œ
                    toggleBackgroundScale(false);
                }, 300);
            } else {
                modal.classList.add('hidden');
                document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ì ê¸ˆ í•´ì œ
                toggleBackgroundScale(false);
            }
        }

        function goToExecutePage(timestamp) {
            const allLoans = JSON.parse(localStorage.getItem('trustFinMyLoans') || '[]');
            // timestampëŠ” ìˆ«ìí˜•ì´ë¯€ë¡œ ë¹„êµ ì‹œ ì£¼ì˜ (ì—¬ê¸°ì„œëŠ” ë¬¸ìì—´ë¡œ ë„˜ì–´ì˜¬ ìˆ˜ ìˆìŒ)
            const loan = allLoans.find(l => l.timestamp == timestamp);
            if (loan) {
                localStorage.setItem('currentLoanApplication', JSON.stringify(loan));
                location.href = 'loan_execute.html';
            }
        }
    </script>
</body>
</html>