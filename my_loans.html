<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TrustFin - 내 대출</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="RecommendLogic.js"></script>
    <script src="common.js"></script>
    <style>
        .chart-line {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 2s ease-out forwards;
        }
        @keyframes drawLine {
            to { stroke-dashoffset: 0; }
        }
    </style>
</head>
<body class="text-gray-800 dark:text-gray-100 font-sans select-none transition-colors duration-300 bg-black">
    <div id="app-content" class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-all duration-300 ease-out origin-top pb-24">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 h-16 sticky top-0 z-20 flex items-center justify-center shadow-sm dark:shadow-gray-900/50 px-4 relative transition-colors duration-300">
            <button onclick="history.back()" class="absolute left-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition">
                <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700 dark:text-gray-300"></i>
            </button>
            <h1 class="text-lg font-bold text-gray-900 dark:text-white">내 대출</h1>
        </header>

        <main class="p-5 max-w-md mx-auto space-y-6">
            <!-- Total Loan Summary -->
            <div class="text-center py-4">
                <p class="text-gray-500 text-sm mb-1">총 대출 잔액</p>
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white"><span id="totalLoan">0</span>원</h2>
            </div>

            <!-- Loan Trend Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-3xl p-6 shadow-lg border border-gray-100 dark:border-gray-700">
                <h3 class="font-bold text-gray-900 dark:text-white mb-4 text-sm">대출 잔액 변동</h3>
                <div class="relative h-32 w-full">
                    <svg id="loanTrendChart" class="w-full h-full overflow-visible"></svg>
                </div>
                <div id="chartLabels" class="flex justify-between text-xs text-gray-400 mt-2 px-1"></div>
            </div>

            <div id="loanList" class="space-y-3">
                <!-- JS로 대출 목록 렌더링 -->
            </div>
        </main>
    </div>

    <!-- Loan Detail Modal -->
    <div id="loanDetailModal" class="fixed inset-0 z-50 hidden flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-md transition-opacity" onclick="closeLoanDetailModal()"></div>
        <div class="bg-white dark:bg-gray-800 rounded-t-2xl p-6 w-full max-w-md shadow-2xl relative z-10 animate-slide-up">
            <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-6"></div>
            
            <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center border border-gray-100 dark:border-gray-600 overflow-hidden">
                    <img id="modalBankLogo" src="" onerror="handleImageError(this)" class="w-full h-full object-cover" alt="bank">
                </div>
                <div>
                    <p id="modalBankName" class="text-sm text-gray-500 dark:text-gray-400">은행명</p>
                    <h3 id="modalProductName" class="font-bold text-gray-900 dark:text-white text-lg">상품명</h3>
                </div>
            </div>

            <div class="space-y-4 text-sm">
                <div class="flex justify-between py-3 border-b border-gray-100 dark:border-gray-700">
                    <span class="text-gray-500 dark:text-gray-400">대출 잔액</span>
                    <span id="modalLoanAmount" class="font-bold text-gray-900 dark:text-white">0원</span>
                </div>
                <div class="flex justify-between py-3 border-b border-gray-100 dark:border-gray-700">
                    <span class="text-gray-500 dark:text-gray-400">적용 금리</span>
                    <span id="modalLoanRate" class="font-bold text-electricPurple dark:text-purple-400">0.0%</span>
                </div>
                <div class="flex justify-between py-3 border-b border-gray-100 dark:border-gray-700">
                    <span class="text-gray-500 dark:text-gray-400">만기일</span>
                    <span id="modalLoanDate" class="font-bold text-gray-900 dark:text-white">2000.01.01</span>
                </div>
            </div>

            <button onclick="closeLoanDetailModal()" class="w-full mt-8 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white font-bold py-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition">닫기</button>
        </div>
    </div>

    <!-- Loan Survey Modal -->
    <div id="loanSurveyModal" class="fixed inset-0 z-50 hidden flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-md transition-opacity" onclick="closeLoanSurveyModal()"></div>
        <div class="bg-white dark:bg-gray-800 rounded-t-2xl p-6 w-full max-w-md shadow-2xl relative z-10 animate-slide-up">
            <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-6"></div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">대출 목적을 알려주세요</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">목적에 맞는 최적의 상품을 추천해드립니다.</p>
            
            <div class="space-y-3 mb-6">
                <button onclick="selectLoanPurpose('living', this)" class="survey-option w-full p-4 rounded-3xl border border-gray-200 dark:border-gray-700 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition flex justify-between items-center group">
                    <span class="text-gray-700 dark:text-gray-300 font-medium">생활비</span>
                    <i data-lucide="check" class="w-5 h-5 text-deepBlue dark:text-blue-400 opacity-0 transition-opacity"></i>
                </button>
                <button onclick="selectLoanPurpose('refinance', this)" class="survey-option w-full p-4 rounded-3xl border border-gray-200 dark:border-gray-700 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition flex justify-between items-center group">
                    <span class="text-gray-700 dark:text-gray-300 font-medium">대환대출 (갈아타기)</span>
                    <i data-lucide="check" class="w-5 h-5 text-deepBlue dark:text-blue-400 opacity-0 transition-opacity"></i>
                </button>
                <button onclick="selectLoanPurpose('housing', this)" class="survey-option w-full p-4 rounded-3xl border border-gray-200 dark:border-gray-700 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition flex justify-between items-center group">
                    <span class="text-gray-700 dark:text-gray-300 font-medium">주택/전세 자금</span>
                    <i data-lucide="check" class="w-5 h-5 text-deepBlue dark:text-blue-400 opacity-0 transition-opacity"></i>
                </button>
                <button onclick="selectLoanPurpose('business', this)" class="survey-option w-full p-4 rounded-3xl border border-gray-200 dark:border-gray-700 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition flex justify-between items-center group">
                    <span class="text-gray-700 dark:text-gray-300 font-medium">사업 자금</span>
                    <i data-lucide="check" class="w-5 h-5 text-deepBlue dark:text-blue-400 opacity-0 transition-opacity"></i>
                </button>
            </div>

            <button id="surveySubmitBtn" onclick="submitLoanSurvey()" disabled class="w-full bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 font-bold py-3 rounded-xl transition cursor-not-allowed">
                다음
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initCommonUI(null);
            renderLoans();
            initBottomSheetDrag('loanDetailModal', closeLoanDetailModal);
            initBottomSheetDrag('loanSurveyModal', closeLoanSurveyModal);
        });

        function renderLoans() {
            const loanListEl = document.getElementById('loanList');
            let allLoans = JSON.parse(localStorage.getItem('trustFinMyLoans') || '[]');
            const persona = JSON.parse(localStorage.getItem('trustFinPersona') || '{}');
            const currentPersonaId = persona.id;

            // 실시간 상태 업데이트 로직 (1분 경과 체크)
            const now = Date.now();
            let dataChanged = false;
            let completedProducts = [];

            allLoans = allLoans.map(loan => {
                if (loan.status === 'pending') {
                    if (now - loan.timestamp > 60000) { // 1분(60000ms) 경과
                        loan.status = 'approved';
                        dataChanged = true;
                        if (loan.personaId === currentPersonaId) {
                            completedProducts.push(loan);
                        }
                    }
                }
                return loan;
            });

            if (dataChanged) {
                localStorage.setItem('trustFinMyLoans', JSON.stringify(allLoans));

                // 심사 완료 알림 추가
                if (completedProducts.length > 0) {
                    const notifications = JSON.parse(localStorage.getItem('trustFinNotifications') || '[]');
                    const date = new Date();
                    const dateStr = `${date.getMonth() + 1}.${date.getDate()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                    
                    completedProducts.forEach(loan => {
                        notifications.unshift({
                            type: 'loan',
                            title: '대출 심사 완료',
                            message: `'${loan.productName}' 심사가 완료되었습니다. 결과를 확인해주세요.`,
                            date: dateStr,
                            productId: loan.id,
                            read: false
                        });
                    });
                    localStorage.setItem('trustFinNotifications', JSON.stringify(notifications));
                    
                    const msg = completedProducts.length === 1 
                        ? `'${completedProducts[0].productName}' 심사 완료` 
                        : `${completedProducts.length}건의 심사가 완료되었습니다.`;
                    if (typeof showGlobalToast === 'function') showGlobalToast(msg);
                    if (typeof updateNotificationBadge === 'function') updateNotificationBadge();
                }
            }

            // 게스트 모드 처리
            if (currentPersonaId === 'guest') {
                document.querySelector('main').innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-3xl p-6 shadow-lg border border-gray-100 dark:border-gray-700 text-center mt-10 opacity-0 animate-slide-in-right">
                        <div class="w-16 h-16 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400 dark:text-gray-500">
                            <i data-lucide="coins" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">대출 내역이 없습니다</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">로그인하고 내 대출 한도와<br>최저 금리를 확인해보세요.</p>
                        <button onclick="location.href='login.html'" class="w-full bg-deepBlue text-white font-bold py-3 rounded-xl hover:bg-blue-800 transition">
                            로그인하기
                        </button>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            // 현재 퍼소나의 대출 내역만 필터링
            const myLoans = allLoans.filter(loan => loan.personaId === currentPersonaId);
            
            // 최신순 정렬
            myLoans.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
            
            let totalLoanAmount = 0;

            if (myLoans.length === 0) {
                loanListEl.innerHTML = `
                    <div class="p-8 text-center text-gray-400 dark:text-gray-500 mb-4">대출 내역이 없습니다.</div>
                    <button onclick="openLoanSurveyModal()" class="w-full py-3 bg-deepBlue text-white font-bold rounded-xl shadow-lg hover:bg-blue-800 transition active:scale-95 flex justify-center items-center gap-2">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                        <span>추가 대출 알아보기</span>
                    </button>`;
            } else {
                loanListEl.innerHTML = myLoans.map((loan, index) => {
                    const isPending = loan.status === 'pending';
                    const isActive = loan.status === 'active';

                    let statusText, statusClass, icon, iconAnim, descText;
                    let step1Class, step2Class, step3Class;
                    let step1Text, step2Text, step3Text;

                    const inactiveBar = "bg-gray-200 dark:bg-gray-700";
                    const activeBar = "bg-deepBlue dark:bg-blue-500";
                    const currentBar = "bg-electricPurple dark:bg-purple-500 animate-pulse";
                    const inactiveText = "text-gray-400";
                    const activeText = "text-deepBlue dark:text-blue-400 font-bold";

                    if (isPending) {
                        statusText = '대출 심사 중';
                        statusClass = 'text-blue-600 bg-blue-50 dark:bg-blue-900/30 dark:text-blue-300';
                        icon = 'loader-2';
                        iconAnim = 'animate-spin';
                        descText = '심사가 진행 중입니다';
                        
                        step1Class = "bg-blue-500 animate-pulse"; step2Class = inactiveBar; step3Class = inactiveBar;
                        step1Text = activeText; step2Text = inactiveText; step3Text = inactiveText;
                    } else if (isActive) {
                        statusText = '대출금 입금 완료';
                        statusClass = 'text-gray-600 bg-gray-100 dark:bg-gray-700 dark:text-gray-300';
                        icon = 'check';
                        iconAnim = '';
                        descText = '이용 중인 상품입니다';
                        
                        // 실제 데이터에 금액이 없으므로 시뮬레이션 값 사용
                        const mockAmount = 30000000; 
                        totalLoanAmount += mockAmount;
                        
                        step1Class = activeBar; step2Class = activeBar; step3Class = activeBar;
                        step1Text = activeText; step2Text = activeText; step3Text = activeText;
                    } else {
                        statusText = '대출 심사 완료';
                        statusClass = 'text-green-600 bg-green-50 dark:bg-green-900/30 dark:text-green-300';
                        icon = 'check-circle-2';
                        iconAnim = '';
                        descText = '클릭하여 상세 정보 확인';
                        
                        step1Class = activeBar; step2Class = currentBar; step3Class = inactiveBar;
                        step1Text = activeText; step2Text = activeText; step3Text = inactiveText;
                    }

                    return `
                        <div onclick="openLoanDetailModal(${loan.timestamp})" class="bg-white dark:bg-gray-800 rounded-3xl p-6 shadow-lg border border-gray-100 dark:border-gray-700 transition-colors cursor-pointer active:scale-95 transform transition-transform opacity-0 animate-slide-in-right" style="animation-delay: ${index * 100}ms">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <div class="flex items-center gap-1.5 mb-1">
                                        <img src="${getBankLogoUrl(loan.bankName)}" onerror="handleImageError(this, '${loan.bankName[0]}')" class="w-4 h-4 rounded-full object-contain" alt="${loan.bankName}">
                                        <span class="text-xs font-bold text-gray-500">${loan.bankName}</span>
                                    </div>
                                    <h4 class="font-bold text-gray-900 dark:text-white text-lg">${loan.productName}</h4>
                                </div>
                                <span class="text-xs font-bold px-2 py-1 rounded ${statusClass} flex items-center gap-1">
                                    <i data-lucide="${icon}" class="w-3 h-3 ${iconAnim}"></i>
                                    ${statusText}
                                </span>
                            </div>
                            <div class="mt-4">
                                <div class="flex gap-1 h-1.5 mb-2">
                                    <div class="flex-1 rounded-full ${step1Class}"></div>
                                    <div class="flex-1 rounded-full ${step2Class}"></div>
                                    <div class="flex-1 rounded-full ${step3Class}"></div>
                                </div>
                                <div class="flex justify-between text-[10px]">
                                    <span class="${step1Text}">심사중</span>
                                    <span class="${step2Text} text-center">심사완료</span>
                                    <span class="${step3Text} text-right">입금완료</span>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mt-2 text-right">
                                ${descText}
                            </p>
                        </div>
                    `;
                }).join('') + `
                    <button onclick="openLoanSurveyModal()" class="w-full mt-4 py-3 text-sm text-gray-500 dark:text-gray-400 font-bold hover:text-deepBlue dark:hover:text-blue-400 transition flex justify-center items-center gap-1 border border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:border-deepBlue dark:hover:border-blue-400">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        <span>추가 대출 알아보기</span>
                    </button>
                `;
            }
            
            document.getElementById('totalLoan').innerText = totalLoanAmount.toLocaleString();
            renderLoanTrendChart(totalLoanAmount);
            lucide.createIcons();

            // 심사 중인 항목이 있으면 1초 뒤 재검사
            const hasPending = myLoans.some(loan => loan.status === 'pending');
            if (hasPending) {
                setTimeout(renderLoans, 1000);
            }
        }

        function openLoanDetailModal(timestamp) {
            const allLoans = JSON.parse(localStorage.getItem('trustFinMyLoans') || '[]');
            const loan = allLoans.find(l => l.timestamp === timestamp);
            
            if (!loan) return;

            // 모든 상태에서 대출 실행 화면으로 이동
            localStorage.setItem('currentLoanApplication', JSON.stringify(loan));
            location.href = 'loan_execute.html';
        }

        function closeLoanDetailModal(animate = true) {
            const modal = document.getElementById('loanDetailModal');
            const content = modal.querySelector('.bg-white');
            
            if (animate) {
                content.classList.remove('animate-slide-up');
                content.classList.add('animate-slide-down');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    content.classList.remove('animate-slide-down');
                    document.body.style.overflow = '';
                    toggleBackgroundScale(false);
                }, 300);
            } else {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                toggleBackgroundScale(false);
            }
        }

        let selectedPurpose = '';

        function openLoanSurveyModal() {
            const modal = document.getElementById('loanSurveyModal');
            const content = modal.querySelector('.bg-white');
            
            // 초기화
            selectedPurpose = '';
            document.querySelectorAll('.survey-option').forEach(el => {
                el.classList.remove('border-deepBlue', 'bg-blue-50', 'dark:border-blue-500', 'dark:bg-blue-900/20');
                const icon = el.querySelector('svg') || el.querySelector('i');
                if (icon) icon.classList.add('opacity-0');
            });
            const btn = document.getElementById('surveySubmitBtn');
            btn.disabled = true;
            btn.classList.remove('bg-deepBlue', 'text-white', 'hover:bg-blue-800');
            btn.classList.add('bg-gray-300', 'dark:bg-gray-700', 'text-gray-500', 'dark:text-gray-400', 'cursor-not-allowed');

            content.classList.add('animate-slide-up');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            toggleBackgroundScale(true);
        }

        function closeLoanSurveyModal(animate = true) {
            const modal = document.getElementById('loanSurveyModal');
            const content = modal.querySelector('.bg-white');
            
            if (animate) {
                content.classList.remove('animate-slide-up');
                content.classList.add('animate-slide-down');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    content.classList.remove('animate-slide-down');
                    document.body.style.overflow = '';
                    toggleBackgroundScale(false);
                }, 300);
            } else {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                toggleBackgroundScale(false);
            }
        }

        function selectLoanPurpose(purpose, element) {
            selectedPurpose = purpose;
            
            document.querySelectorAll('.survey-option').forEach(el => {
                el.classList.remove('border-deepBlue', 'bg-blue-50', 'dark:border-blue-500', 'dark:bg-blue-900/20');
                const icon = el.querySelector('svg') || el.querySelector('i');
                if (icon) icon.classList.add('opacity-0');
            });
            
            element.classList.add('border-deepBlue', 'bg-blue-50', 'dark:border-blue-500', 'dark:bg-blue-900/20');
            const targetIcon = element.querySelector('svg') || element.querySelector('i');
            if (targetIcon) targetIcon.classList.remove('opacity-0');

            const btn = document.getElementById('surveySubmitBtn');
            btn.disabled = false;
            btn.classList.remove('bg-gray-300', 'dark:bg-gray-700', 'text-gray-500', 'dark:text-gray-400', 'cursor-not-allowed');
            btn.classList.add('bg-deepBlue', 'text-white', 'hover:bg-blue-800');
        }

        function submitLoanSurvey() {
            if (!selectedPurpose) return;
            
            // 기존 데이터 유지하면서 목적 추가
            const userData = JSON.parse(localStorage.getItem('trustFinUserData') || '{}');
            userData.loanPurpose = selectedPurpose;
            localStorage.setItem('trustFinUserData', JSON.stringify(userData));
            
            location.href = 'loan_input.html';
        }

        function renderLoanTrendChart(currentTotal) {
            const svg = document.getElementById('loanTrendChart');
            const labelsDiv = document.getElementById('chartLabels');
            if (!svg) return;

            // 초기화
            svg.innerHTML = '';
            labelsDiv.innerHTML = '';

            // 데이터 생성 (최근 6개월)
            const data = [];
            const months = [];
            const now = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                months.push(`${d.getMonth() + 1}월`);
                
                // 가상 데이터: 현재 잔액이 0이면 모두 0, 아니면 과거로 갈수록 조금씩 많게 (상환 시나리오)
                if (currentTotal === 0) {
                    data.push(0);
                } else {
                    // 변동폭을 조금 더 자연스럽게 (선형적으로 감소)
                    const val = currentTotal + ((5 - i) * 1000000); 
                    data.push(val);
                }
            }

            // 차트 그리기 설정
            const width = svg.clientWidth || 300;
            const height = svg.clientHeight || 128;
            const padding = 10;
            
            const minVal = Math.min(...data) * 0.9;
            const maxVal = Math.max(...data) * 1.1;
            const range = maxVal - minVal || 1; // 0으로 나누기 방지

            const points = data.map((val, i) => {
                const x = (i / (data.length - 1)) * (width - padding * 2) + padding;
                const y = height - ((val - minVal) / range) * (height - padding * 2) - padding;
                return `${x},${y}`;
            }).join(' ');

            // 그라데이션 정의
            const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
            defs.innerHTML = `
                <linearGradient id="chartGradient" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="#7C3AED" stop-opacity="0.2"/>
                    <stop offset="100%" stop-color="#7C3AED" stop-opacity="0"/>
                </linearGradient>
            `;
            svg.appendChild(defs);

            // 영역 채우기 (Area)
            const areaPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const firstPoint = points.split(' ')[0];
            const lastPoint = points.split(' ')[points.split(' ').length - 1];
            const areaD = `M ${points} L ${lastPoint.split(',')[0]},${height} L ${firstPoint.split(',')[0]},${height} Z`;
            
            areaPath.setAttribute("d", areaD);
            areaPath.setAttribute("fill", "url(#chartGradient)");
            areaPath.style.opacity = '0';
            areaPath.style.transition = 'opacity 1s ease-out';
            setTimeout(() => areaPath.style.opacity = '1', 100);
            svg.appendChild(areaPath);

            // 선 그리기 (Line)
            const line = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
            line.setAttribute("points", points);
            line.setAttribute("fill", "none");
            line.setAttribute("stroke", "#7C3AED"); // electricPurple
            line.setAttribute("stroke-width", "3");
            line.setAttribute("stroke-linecap", "round");
            line.setAttribute("stroke-linejoin", "round");
            line.setAttribute("class", "chart-line");
            svg.appendChild(line);

            // 점 그리기 (Dots)
            data.forEach((val, i) => {
                const x = (i / (data.length - 1)) * (width - padding * 2) + padding;
                const y = height - ((val - minVal) / range) * (height - padding * 2) - padding;
                
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", x);
                circle.setAttribute("cy", y);
                circle.setAttribute("r", "4");
                circle.setAttribute("fill", "#fff");
                circle.setAttribute("stroke", "#7C3AED");
                circle.setAttribute("stroke-width", "2");
                circle.setAttribute("class", "opacity-0 transition-opacity duration-500");
                circle.style.transitionDelay = `${i * 100 + 500}ms`;
                svg.appendChild(circle);
                
                // 애니메이션 트리거
                setTimeout(() => circle.classList.remove("opacity-0"), 100);
            });

            // X축 레이블 생성
            labelsDiv.innerHTML = months.map(m => `<span>${m}</span>`).join('');
        }
    </script>
</body>
</html>